$.extend($.coral,{tree:{version:"4.0.2"}});var _final={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},editIcon:"cui-icon-pencil7",removeIcon:"cui-icon-cross2",event:{NODECREATED:"tree_nodeCreated",CLICK:"tree_click",EXPAND:"tree_expand",COLLAPSE:"tree_collapse",ASYNC_SUCCESS:"tree_async_success",ASYNC_ERROR:"tree_async_error",REMOVE:"tree_remove",CHECK:"tree_check",DRAG:"tree_drag",DROP:"tree_drop",RENAME:"tree_rename",DRAGMOVE:"tree_dragmove"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul",CHECK:"_check",EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},line:{CENTER:"centerDottedLine",BOTTOM:"bottomDottedLine",ROOTS:"topDottedLine",NOLINE:"noline",LINE:"dottedLine"},folder:{OPEN:"folderOpen",CLOSE:"folderClose",FILE:"file",DOCU:"docu"},arrow:{RIGHT:"arrowRight1",DOWN:"arrowDown1"},node:{CURHOVER:"coral-state-hover",CURSELECTED:"curSelectedNode",CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetTree",TMPTARGET_NODE:"tmpTargetNode"},checkbox:{STYLE:"checkbox",DEFAULT:"coral-state-default",DISABLED:"coral-state-disabled",FALSE:"false",TRUE:"true",UNCHECKED:"unchecked",CHECKED:"checked",PARTIAL:"Partical",FOCUS:"coral-state-focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"}},_option={treeId:"",treeObj:null,clickExpand:false,disabled:false,addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},iconUrl:true,nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:false,enableHighlight:false,showTitle:true,txtSelectedEnable:false,rootInNode:false,showRootNode:true,rootNode:false,keyChildren:"children",keyName:"name",keyTitle:"",keyUrl:"url",simpleDataEnable:false,simpleDataIdKey:"id",simpleDataPIdKey:"pId",simpleDataRootPId:null,keepParent:false,keepLeaf:false,asyncEnable:false,asyncContentType:"application/x-www-form-urlencoded",asyncType:"post",asyncDataType:"text",asyncUrl:"",asyncAutoParam:[],asyncOtherParam:[],asyncDataFilter:null,checkable:false,autoCheckTrigger:false,chkStyle:_final.checkbox.STYLE,nocheckInherit:false,chkDisabledInherit:false,radioType:_final.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"},keyChecked:"checked",editable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",dragStyle:"line",dragAutoExpandTrigger:false,dragIsCopy:true,dragIsMove:true,dragPrev:true,dragNext:true,dragInner:true,dragMinMoveSize:5,dragBorderMax:10,dragBorderMin:-5,dragMaxShowNodeNum:5,dragAutoOpenTime:500,addHoverDom:null,removeHoverDom:null,beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeReName:null,onDrag:null,onDragMove:null,onDrop:null,onReName:null,beforeCheck:null,onCheck:null,beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onLoadError:null,onLoad:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null};
$.tree={_coreInitRoot:function(b){var a=$.tree._getRoot(b);if(!a){a={};$.tree._setRoot(b,a)}a[b.keyChildren]=[];a.expandTriggerFlag=false;a.curSelectedList=[];a.noSelection=true;a.createdNodes=[];a.zId=0;a._ver=(new Date()).getTime()},_checkInitRoot:function(b){var a=$.tree._getRoot(b);a.radioCheckedList=[]},_editInitRoot:function(c){var b=$.tree._getRoot(c),a=$.tree._getRoots();b.curEditNode=null;b.curEditInput=null;b.curHoverNode=null;b.dragFlag=0;b.dragNodeShowBefore=[];b.dragMaskList=new Array();a.showHoverDom=true},_coreInitCache:function(b){var a=$.tree._getCache(b);if(!a){a={};$.tree._setCache(b,a)}a.nodes=[];a.doms=[]},_checkInitCache:function(a){},_editInitCache:function(a){},_coreBindEvent:function(b){var c=b.treeObj,a=consts.event;c.bind(a.NODECREATED,function(e,f,d){$.tree._apply(b.onNodeCreated,[e,f,d,b])});c.bind(a.CLICK,function(g,f,h,e,d){$.tree._apply(b.onClick,[f,h,e,d,b])});c.bind(a.EXPAND,function(e,f,d){$.tree._apply(b.onExpand,[e,f,d,b])});c.bind(a.COLLAPSE,function(e,f,d){$.tree._apply(b.onCollapse,[e,f,d,b])});c.bind(a.ASYNC_SUCCESS,function(e,f,d,g){$.tree._apply(b.onLoad,[e,f,d,g,b])});c.bind(a.ASYNC_ERROR,function(f,g,e,d,i,h){$.tree._apply(b.onLoadError,[f,g,e,d,i,h,b])});c.bind(a.REMOVE,function(d,f,e){$.tree._apply(b.onRemove,[d,f,e,b])})},_checkBindEvent:function(b){var c=b.treeObj,a=consts.event;c.bind(a.CHECK,function(f,e,g,d){f.srcEvent=e;$.tree._apply(b.onCheck,[f,g,d,b])})},_editBindEvent:function(b){var c=b.treeObj;var a=consts.event;c.bind(a.RENAME,function(e,g,f,d){$.tree._apply(b.onReName,[e,g,f,d,b])});c.bind(a.DRAG,function(e,d,g,f){$.tree._apply(b.onDrag,[d,g,f,b])});c.bind(a.DRAGMOVE,function(e,d,g,f){$.tree._apply(b.onDragMove,[d,g,f,b])});c.bind(a.DROP,function(g,f,i,h,j,e,d){$.tree._apply(b.onDrop,[f,i,h,j,e,d,b])})},_coreUnbindEvent:function(b){var c=b.treeObj,a=consts.event;c.unbind(a.NODECREATED).unbind(a.CLICK).unbind(a.EXPAND).unbind(a.COLLAPSE).unbind(a.ASYNC_SUCCESS).unbind(a.ASYNC_ERROR).unbind(a.REMOVE)},_checkUnbindEvent:function(b){var c=b.treeObj;
var a=consts.event;c.unbind(a.CHECK)},_editUnbindEvent:function(b){var c=b.treeObj;var a=consts.event;c.unbind(a.RENAME);c.unbind(a.DRAG);c.unbind(a.DRAGMOVE);c.unbind(a.DROP)},_coreEventProxy:function(b){var i=b.target,k=$.tree._getSetting(b.data.treeId),g="",c=null,d="",h="",a=null,f=null,e=null;if($.tree._eqs(b.type,"mousedown")){h="mousedown"}else{if($.tree._eqs(b.type,"mouseup")){h="mouseup"}else{if($.tree._eqs(b.type,"contextmenu")){h="contextmenu"}else{if($.tree._eqs(b.type,"click")){if($.tree._eqs(i.tagName,"span")&&i.getAttribute("treeNode"+consts.id.SWITCH)!==null){g=$.tree._getNodeMainDom(i).id;d="switchNode"}else{e=$.tree._getMDom(k,i,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(e){g=$.tree._getNodeMainDom(e).id;d="clickNode"}}}else{if($.tree._eqs(b.type,"dblclick")){h="dblclick";e=$.tree._getMDom(k,i,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(e){g=$.tree._getNodeMainDom(e).id;d="switchNode"}}}}}}if(h.length>0&&g.length==0){e=$.tree._getMDom(k,i,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(e){g=$.tree._getNodeMainDom(e).id}}if(g.length>0){c=$.tree._getNodeCache(k,g);switch(d){case"switchNode":if(!c.isParent){d=""}else{if($.tree._eqs(b.type,"click")||($.tree._eqs(b.type,"dblclick")&&$.tree._apply(k.dblClickExpand,[k.treeId,c,k],k.dblClickExpand))){a=$.tree._onSwitchNode}else{d=""}}break;case"clickNode":a=$.tree._onClickNode;break}}switch(h){case"mousedown":f=$.tree._onTreeMousedown;break;case"mouseup":f=$.tree._onTreeMouseup;break;case"dblclick":f=$.tree._onTreeDblclick;break;case"contextmenu":f=$.tree._onTreeContextmenu;break}var j={stop:false,node:c,nodeEventType:d,nodeEventCallback:a,treeEventType:h,treeEventCallback:f};return j},_checkEventProxy:function(h){var i=h.target,k=$.tree._getSetting(h.data.treeId),f="",b=null,c="",g="",a=null,d=null;if($.tree._eqs(h.type,"mouseover")){if(k.checkable&&$.tree._eqs(i.tagName,"span")&&i.getAttribute("treeNode"+consts.id.CHECK)!==null){f=$.tree._getNodeMainDom(i).id;c="mouseoverCheck"}}else{if($.tree._eqs(h.type,"mouseout")){if(k.checkable&&$.tree._eqs(i.tagName,"span")&&i.getAttribute("treeNode"+consts.id.CHECK)!==null){f=$.tree._getNodeMainDom(i).id;
c="mouseoutCheck"}}else{if($.tree._eqs(h.type,"click")){if(k.checkable&&$.tree._eqs(i.tagName,"span")&&i.getAttribute("treeNode"+consts.id.CHECK)!==null){f=$.tree._getNodeMainDom(i).id;c="checkNode"}}}}if(f.length>0){b=$.tree._getNodeCache(k,f);switch(c){case"checkNode":a=$.tree._onCheckNode;break;case"mouseoverCheck":a=$.tree._onMouseoverCheck;break;case"mouseoutCheck":a=$.tree._onMouseoutCheck;break}}var j={stop:c==="checkNode",node:b,nodeEventType:c,nodeEventCallback:a,treeEventType:g,treeEventCallback:d};return j},_editEventProxy:function(i){var j=i.target,m=$.tree._getSetting(i.data.treeId),k=i.relatedTarget,g="",b=null,c="",h="",a=null,f=null,d=null;if($.tree._eqs(i.type,"mouseover")){d=$.tree._getMDom(m,j,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){g=$.tree._getNodeMainDom(d).id;c="hoverOverNode"}}else{if($.tree._eqs(i.type,"mouseout")){d=$.tree._getMDom(m,k,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(!d){g="remove";c="hoverOutNode"}}else{if($.tree._eqs(i.type,"mousedown")){d=$.tree._getMDom(m,j,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(d){g=$.tree._getNodeMainDom(d).id;c="mousedownNode"}}}}if(g.length>0){b=$.tree._getNodeCache(m,g);switch(c){case"mousedownNode":a=$.tree._onMousedownNode;break;case"hoverOverNode":a=$.tree._onHoverOverNode;break;case"hoverOutNode":a=$.tree._onHoverOutNode;break}}var l={stop:false,node:b,nodeEventType:c,nodeEventCallback:a,treeEventType:h,treeEventCallback:f};return l},_beforeA:function(c,d,b){var a=c.keyChecked;if(c.checkable){$.tree._makeChkFlag(c,d);b.push("<span ID='",d.tId,consts.id.CHECK,"' class='",$.tree._makeChkClass(c,d),"' treeNode",consts.id.CHECK,(d.nocheck===true?" style='display:none;'":""),"></span>")}},_coreInitNode:function(i,b,e,f,h,g,c){if(!e){return}var a=$.tree._getRoot(i),d=i.keyChildren;e.level=b;e.tId=i.treeId+"_"+(++a.zId);e.parentTId=f?f.tId:null;e.open=(typeof e.open=="string")?$.tree._eqs(e.open,"true"):!!e.open;if(e[d]&&e[d].length>0){e.isParent=true;e.zAsync=true}else{e.isParent=(typeof e.isParent=="string")?$.tree._eqs(e.isParent,"true"):!!e.isParent;
e.open=(e.isParent&&!i.asyncEnable)?e.open:false;e.zAsync=!e.isParent}e.isFirstNode=h;e.isLastNode=g;e.getParentNode=function(){return $.tree._getNodeCache(i,e.parentTId)};e.getPreNode=function(){return $.tree._getPreNode(i,e)};e.getNextNode=function(){return $.tree._getNextNode(i,e)};e.isAjaxing=false;$.tree._fixPIdKeyValue(i,e)},_checkInitNode:function(i,c,e,f,h,g,d){if(!e){return}var b=i.keyChecked;if(typeof e[b]=="string"){e[b]=$.tree._eqs(e[b],"true")}e[b]=!!e[b];e.checkedOld=e[b];if(typeof e.nocheck=="string"){e.nocheck=$.tree._eqs(e.nocheck,"true")}e.nocheck=!!e.nocheck||(i.nocheckInherit&&f&&!!f.nocheck);if(typeof e.chkDisabled=="string"){e.chkDisabled=$.tree._eqs(e.chkDisabled,"true")}e.chkDisabled=!!e.chkDisabled||(i.chkDisabledInherit&&f&&!!f.chkDisabled);if(typeof e.halfCheck=="string"){e.halfCheck=$.tree._eqs(e.halfCheck,"true")}e.halfCheck=!!e.halfCheck;e.check_Child_State=-1;e.check_Focus=false;e.getCheckStatus=function(){return $.tree._getCheckStatus(i,e)};if(i.chkStyle==consts.radio.STYLE&&i.radioType==consts.radio.TYPE_ALL&&e[b]){var a=$.tree._getRoot(i);a.radioCheckedList.push(e)}},_editInitNode:function(c,g,d,a,f,b,e){if(!d){return}d.isHover=false;d.editNameFlag=false},_checkTreeTools:function(c,b){b.checkNode=function(h,g,i,f){var d=this.setting.keyChecked;if(h.chkDisabled===true){return}if(g!==true&&g!==false){g=!h[d]}f=!!f;if(h[d]===g&&!i){return}else{if(f&&$.tree._apply(this.setting.beforeCheck,[this.setting.treeId,h,this.setting],true)==false){return}}if($.tree._uCanDo(this.setting)&&this.setting.checkable&&h.nocheck!==true){h[d]=g;var e=$$(h,consts.id.CHECK,this.setting);if(i||this.setting.chkStyle===consts.radio.STYLE){$.tree._checkNodeRelation(this.setting,h)}$.tree._setChkClass(this.setting,e,h);$.tree._repairParentChkClassWithSelf(this.setting,h);if(f){this.setting.treeObj.trigger(consts.event.CHECK,[null,this.setting.treeId,h])}}};b.checkAllNodes=function(d){$.tree._repairAllChk(this.setting,!!d)};b.getCheckedNodes=function(e){var d=this.setting.keyChildren;
e=(e!==false);return $.tree._getTreeCheckedNodes(this.setting,$.tree._getRoot(this.setting)[d],e)};b.getChangeCheckedNodes=function(){var d=this.setting.keyChildren;return $.tree._getTreeChangeCheckedNodes(this.setting,$.tree._getRoot(this.setting)[d])};b.setChkDisabled=function(e,d,f,g){d=!!d;f=!!f;g=!!g;$.tree._repairSonChkDisabled(this.setting,e,d,g);$.tree._repairParentChkDisabled(this.setting,e.getParentNode(),d,f)};var a=b.updateNode;b.updateNode=function(f,g){if(a){a.apply(b,arguments)}if(!f||!this.setting.checkable){return}var d=$$(f,this.setting);if(d.get(0)&&$.tree._uCanDo(this.setting)){var e=$$(f,consts.id.CHECK,this.setting);if(g==true||this.setting.chkStyle===consts.radio.STYLE){$.tree._checkNodeRelation(this.setting,f)}$.tree._setChkClass(this.setting,e,f);$.tree._repairParentChkClassWithSelf(this.setting,f)}}},_editTreeTools:function(b,a){a.cancelEditName=function(d){var c=$.tree._getRoot(this.setting);if(!c.curEditNode){return}$.tree._cancelCurEditNode(this.setting,d?d:null,true)};a.copyNode=function(g,f,e,i){if(!f){return null}if(g&&!g.isParent&&this.setting.keepLeaf&&e===consts.move.TYPE_INNER){return null}var h=this,c=$.tree._clone(f);if(!g){g=null;e=consts.move.TYPE_INNER}if(e==consts.move.TYPE_INNER){function d(){$.tree._addNodes(h.setting,g,[c],i)}if($.tree._canAsync(this.setting,g)){$.tree._asyncNode(this.setting,g,i,d)}else{d()}}else{$.tree._addNodes(this.setting,g.parentNode,[c],i);$.tree._moveNode(this.setting,g,c,e,false,i)}return c};a.editName=function(c){if(!c||!c.tId||c!==$.tree._getNodeCache(this.setting,c.tId)){return}if(c.parentTId){$.tree._expandCollapseParentNode(this.setting,c.getParentNode(),true)}$.tree._editNode(this.setting,c)};a.moveNode=function(e,d,c,h){if(!d){return d}if(e&&!e.isParent&&this.setting.keepLeaf&&c===consts.move.TYPE_INNER){return null}else{if(e&&((d.parentTId==e.tId&&c==consts.move.TYPE_INNER)||$$(d,this.setting).find("#"+e.tId).length>0)){return null}else{if(!e){e=null}}}var g=this;function f(){$.tree._moveNode(g.setting,e,d,c,false,h)
}if($.tree._canAsync(this.setting,e)&&c===consts.move.TYPE_INNER){$.tree._asyncNode(this.setting,e,h,f)}else{f()}return d};a.setEditable=function(c){this.setting.editable=c;return this.refresh()}},_addNodeCache:function(a,b){$.tree._getCache(a).nodes[$.tree._getNodeCacheId(b.tId)]=b},_getNodeCacheId:function(a){return a.substring(a.lastIndexOf("_")+1)},_addNodesData:function(c,a,b){var d=c.keyChildren;if(!a[d]){a[d]=[]}if(a[d].length>0){a[d][a[d].length-1].isLastNode=false;$.tree._setNodeLineIcos(c,a[d][a[d].length-1])}a.isParent=true;a[d]=a[d].concat(b)},_addSelectedNode:function(b,c){var a=$.tree._getRoot(b);if(!$.tree._isSelectedNode(b,c)){a.curSelectedList.push(c)}},_addCreatedNode:function(b,c){if(!!b.onNodeCreated||!!b.addDiyDom){var a=$.tree._getRoot(b);a.createdNodes.push(c)}},_fixPIdKeyValue:function(a,b){if(a.simpleDataEnable){b[a.simpleDataPIdKey]=b.parentTId?b.getParentNode()[a.simpleDataIdKey]:a.simpleDataRootPId}},_getAfterA:function(c,d,e){for(var b=0,a=_init.afterA.length;b<a;b++){_init.afterA[b].apply(this,arguments)}},_getBeforeA:function(c,d,e){for(var b=0,a=_init.beforeA.length;b<a;b++){_init.beforeA[b].apply(this,arguments)}},_getInnerAfterA:function(c,d,e){for(var b=0,a=_init.innerAfterA.length;b<a;b++){_init.innerAfterA[b].apply(this,arguments)}},_getInnerBeforeA:function(c,d,e){for(var b=0,a=_init.innerBeforeA.length;b<a;b++){_init.innerBeforeA[b].apply(this,arguments)}},_getCache:function(a){return caches[a.treeId]},_getNextNode:function(c,e){if(!e){return null}var d=c.keyChildren,f=e.parentTId?e.getParentNode():$.tree._getRoot(c);for(var b=0,a=f[d].length-1;b<=a;b++){if(f[d][b]===e){return(b==a?null:f[d][b+1])}}return null},_getNodeByParam:function(f,b,e,h){if(!b||!e){return null}var g=f.keyChildren;for(var d=0,a=b.length;d<a;d++){if(b[d][e]==h){return b[d]}var c=$.tree._getNodeByParam(f,b[d][g],e,h);if(c){return c}}return null},_getNodeCache:function(a,c){if(!c){return null}var b=caches[a.treeId].nodes[$.tree._getNodeCacheId(c)];return b?b:null
},_getNodeName:function(b,c){var a=b.keyName;return""+c[a]},_getNodeTitle:function(b,c){var a=b.keyTitle===""?b.keyName:b.keyTitle;return""+c[a]},_getNodes:function(a){return $.tree._getRoot(a)[a.keyChildren]},_getNodesByParam:function(f,c,e,h){if(!c||!e){return[]}var g=f.keyChildren,a=[];for(var d=0,b=c.length;d<b;d++){if(c[d][e]==h){a.push(c[d])}a=a.concat($.tree._getNodesByParam(f,c[d][g],e,h))}return a},_getNodesByParamFuzzy:function(f,c,e,h){if(!c||!e){return[]}var g=f.keyChildren,a=[];h=h.toLowerCase();for(var d=0,b=c.length;d<b;d++){if(typeof c[d][e]=="string"&&c[d][e].toLowerCase().indexOf(h)>-1){a.push(c[d])}a=a.concat($.tree._getNodesByParamFuzzy(f,c[d][g],e,h))}return a},_getNodesByFilter:function(j,a,b,f,h){if(!a){return(f?null:[])}var c=j.keyChildren,k=f?null:[];for(var e=0,d=a.length;e<d;e++){if($.tree._apply(b,[a[e],h],false)){if(f){return a[e]}k.push(a[e])}var g=$.tree._getNodesByFilter(j,a[e][c],b,f,h);if(f&&!!g){return g}k=f?g:k.concat(g)}return k},_getPreNode:function(c,e){if(!e){return null}var d=c.keyChildren,f=e.parentTId?e.getParentNode():$.tree._getRoot(c);for(var b=0,a=f[d].length;b<a;b++){if(f[d][b]===e){return(b==0?null:f[d][b-1])}}return null},_getRadioCheckedList:function(d){var c=$.tree._getRoot(d).radioCheckedList;for(var b=0,a=c.length;b<a;b++){if(!$.tree._getNodeCache(d,c[b].tId)){c.splice(b,1);b--;a--}}return c},_getCheckStatus:function(b,d){if(!b.checkable||d.nocheck||d.chkDisabled){return null}var a=b.keyChecked,c={checked:d[a],half:d.halfCheck?d.halfCheck:(b.chkStyle==consts.radio.STYLE?(d.check_Child_State===2):(d[a]?(d.check_Child_State>-1&&d.check_Child_State<2):(d.check_Child_State>0)))};return c},_getTreeCheckedNodes:function(j,b,h,e){if(!b){return[]}var c=j.keyChildren,a=j.keyChecked,g=(h&&j.chkStyle==consts.radio.STYLE&&j.radioType==consts.radio.TYPE_ALL);e=!e?[]:e;for(var f=0,d=b.length;f<d;f++){if(b[f].nocheck!==true&&b[f].chkDisabled!==true&&b[f][a]==h){e.push(b[f]);if(g){break}}$.tree._getTreeCheckedNodes(j,b[f][c],h,e);
if(g&&e.length>0){break}}return e},_getTreeChangeCheckedNodes:function(f,c,e){if(!c){return[]}var g=f.keyChildren,b=f.keyChecked;e=!e?[]:e;for(var d=0,a=c.length;d<a;d++){if(c[d].nocheck!==true&&c[d].chkDisabled!==true&&c[d][b]!=c[d].checkedOld){e.push(c[d])}$.tree._getTreeChangeCheckedNodes(f,c[d][g],e)}return e},_getRoot:function(a){return a?roots[a.treeId]:null},_getRoots:function(){return roots},_getSetting:function(a){return settings[a]},_getSettings:function(){return settings},_getTreeTools:function(b){var a=this._getRoot(this._getSetting(b));return a?a.treeTools:null},_initCache:function(c){for(var b=0,a=_init.caches.length;b<a;b++){_init.caches[b].apply(this,arguments)}},_initNode:function(e,h,f,b,g,a){for(var d=0,c=_init.nodes.length;d<c;d++){_init.nodes[d].apply(this,arguments)}},_initRoot:function(c){for(var b=0,a=_init.roots.length;b<a;b++){_init.roots[b].apply(this,arguments)}},_isSelectedNode:function(d,e){var a=$.tree._getRoot(d);for(var c=0,b=a.curSelectedList.length;c<b;c++){if(e===a.curSelectedList[c]){return true}}return false},_removeNodeCache:function(c,e){var d=c.keyChildren;if(e[d]){for(var b=0,a=e[d].length;b<a;b++){arguments.callee(c,e[d][b])}}$.tree._getCache(c).nodes[$.tree._getNodeCacheId(e.tId)]=null},_removeSelectedNode:function(d,e){var a=$.tree._getRoot(d);for(var c=0,b=a.curSelectedList.length;c<b;c++){if(e===a.curSelectedList[c]||!$.tree._getNodeCache(d,a.curSelectedList[c].tId)){a.curSelectedList.splice(c,1);c--;b--}}},_setCache:function(b,a){caches[b.treeId]=a},_setRoot:function(b,a){roots[b.treeId]=a},_setTreeTools:function(d,a){for(var c=0,b=_init.treeTools.length;c<b;c++){_init.treeTools[c].apply(this,arguments)}},_makeChkFlag:function(h,c){if(!c){return}var b=h.keyChildren,a=h.keyChecked,e=-1;if(c[b]){for(var g=0,d=c[b].length;g<d;g++){var j=c[b][g];var f=-1;if(h.chkStyle==consts.radio.STYLE){if(j.nocheck===true||j.chkDisabled===true){f=j.check_Child_State}else{if(j.halfCheck===true){f=2}else{if(j[a]){f=2}else{f=j.check_Child_State>0?2:0
}}}if(f==2){e=2;break}else{if(f==0){e=0}}}else{if(h.chkStyle==consts.checkbox.STYLE){if(j.nocheck===true||j.chkDisabled===true){f=j.check_Child_State}else{if(j.halfCheck===true){f=1}else{if(j[a]){f=(j.check_Child_State===-1||j.check_Child_State===2)?2:1}else{f=(j.check_Child_State>0)?1:0}}}if(f===1){e=1;break}else{if(f===2&&e>-1&&g>0&&f!==e){e=1;break}else{if(e===2&&f>-1&&f<2){e=1;break}else{if(f>-1){e=f}}}}}}}}c.check_Child_State=e},_setSonNodeLevel:function(d,a,f){if(!f){return}var e=d.keyChildren;f.level=(a)?a.level+1:0;if(!f[e]){return}for(var c=0,b=f[e].length;c<b;c++){if(f[e][c]){$.tree._setSonNodeLevel(d,f,f[e][c])}}},_transformToArrayFormat:function(d,b){if(!b){return[]}var f=d.keyChildren,e=[];if($.tree._isArray(b)){for(var c=0,a=b.length;c<a;c++){e.push(b[c]);if(b[c][f]){e=e.concat($.tree._transformToArrayFormat(d,b[c][f]))}}}else{e.push(b);if(b[f]){e=e.concat($.tree._transformToArrayFormat(d,b[f]))}}return e},_transformToTreeFormat:function(j,b){var e,d,g=j.simpleDataIdKey,f=j.simpleDataPIdKey,c=j.keyChildren;if(!g||g==""||!b){return[]}if($.tree._isArray(b)){var a=[];var h=[];for(e=0,d=b.length;e<d;e++){h[b[e][g]]=b[e]}for(e=0,d=b.length;e<d;e++){if(h[b[e][f]]&&b[e][g]!=b[e][f]){if(!h[b[e][f]][c]){h[b[e][f]][c]=[]}h[b[e][f]][c].push(b[e])}else{a.push(b[e])}}return a}else{return[b]}},_bindEvent:function(c){for(var b=0,a=_init.bind.length;b<a;b++){_init.bind[b].apply(this,arguments)}},_unbindEvent:function(c){for(var b=0,a=_init.unbind.length;b<a;b++){_init.unbind[b].apply(this,arguments)}},_bindTree:function(b){var a={treeId:b.treeId},c=b.treeObj;if(!b.txtSelectedEnable){c.bind("selectstart",function(f){var d;var g=f.originalEvent.srcElement.nodeName.toLowerCase();return(g==="input"||g==="textarea")}).css({"-moz-user-select":"-moz-none"})}c.bind("click",a,$.tree._proxy);c.bind("dblclick",a,$.tree._proxy);c.bind("mouseover",a,$.tree._proxy);c.bind("mouseout",a,$.tree._proxy);c.bind("mousedown",a,$.tree._proxy);c.bind("mouseup",a,$.tree._proxy);c.bind("contextmenu",a,$.tree._proxy)
},_unbindTree:function(a){var b=a.treeObj;b.unbind("click",$.tree._proxy);b.unbind("dblclick",$.tree._proxy);b.unbind("mouseover",$.tree._proxy);b.unbind("mouseout",$.tree._proxy);b.unbind("mousedown",$.tree._proxy);b.unbind("mouseup",$.tree._proxy);b.unbind("contextmenu",$.tree._proxy)},_doProxy:function(f){var d=[];for(var c=0,b=_init.proxys.length;c<b;c++){var a=_init.proxys[c].apply(this,arguments);d.push(a);if(a.stop){break}}return d},_proxy:function(j){var g=$.tree._getSetting(j.data.treeId);if(!$.tree._uCanDo(g,j)){return true}var f=$.tree._doProxy(j),h=true,a=false;for(var d=0,b=f.length;d<b;d++){var c=f[d];if(c.nodeEventCallback){a=true;h=c.nodeEventCallback.apply(c,[j,c.node])&&h}if(c.treeEventCallback){a=true;h=c.treeEventCallback.apply(c,[j,c.node])&&h}}return h},_onSwitchNode:function(c,b){var a=$.tree._getSetting(c.data.treeId);if(b.open){if($.tree._apply(a.beforeCollapse,[a.treeId,b,a],true)==false){return true}$.tree._getRoot(a).expandTriggerFlag=true;$.tree._switchNode(a,b)}else{if($.tree._apply(a.beforeExpand,[a.treeId,b,a],true)==false){return true}$.tree._getRoot(a).expandTriggerFlag=true;$.tree._switchNode(a,b)}return true},_onClickNode:function(d,c){var a=$.tree._getSetting(d.data.treeId),b=((a.autoCancelSelected&&(d.ctrlKey||d.metaKey))&&$.tree._isSelectedNode(a,c))?0:(a.autoCancelSelected&&(d.ctrlKey||d.metaKey)&&a.selectedMulti)?2:1;if($.tree._apply(a.beforeClick,[a.treeId,c,b,a],true)==false){return true}if(b===0){$.tree._cancelPreSelectedNode(a,c)}else{$.tree._selectNode(a,c,b===2)}a.treeObj.trigger(consts.event.CLICK,[d,a.treeId,c,b]);if(a.clickExpand){$(a.treeObj).tree("expandNode",c,null,null,null,true)}return true},_onTreeMousedown:function(c,b){var a=$.tree._getSetting(c.data.treeId);if($.tree._apply(a.beforeMouseDown,[a.treeId,b,a],true)){$.tree._apply(a.onMouseDown,[c,a.treeId,b,a])}return true},_onTreeMouseup:function(c,b){var a=$.tree._getSetting(c.data.treeId);if($.tree._apply(a.beforeMouseUp,[a.treeId,b,a],true)){$.tree._apply(a.onMouseUp,[c,a.treeId,b,a])
}return true},_onTreeDblclick:function(c,b){var a=$.tree._getSetting(c.data.treeId);if($.tree._apply(a.beforeDblClick,[a.treeId,b,a],true)){$.tree._apply(a.onDblClick,[c,a.treeId,b,a])}return true},_onTreeContextmenu:function(c,b){var a=$.tree._getSetting(c.data.treeId);if($.tree._apply(a.beforeRightClick,[a.treeId,b,a],true)){$.tree._apply(a.onRightClick,[c,a.treeId,b,a])}return(typeof a.onRightClick)!="function"},_onCheckNode:function(e,d){if(d.chkDisabled===true){return false}var c=$.tree._getSetting(e.data.treeId),a=c.keyChecked;if($.tree._apply(c.beforeCheck,[c.treeId,d,c],true)==false){return true}d[a]=!d[a];$.tree._checkNodeRelation(c,d);var b=$$(d,consts.id.CHECK,c);$.tree._setChkClass(c,b,d);$.tree._repairParentChkClassWithSelf(c,d);c.treeObj.trigger(consts.event.CHECK,[e,c.treeId,d]);return true},_onMouseoverCheck:function(d,c){if(c.chkDisabled===true){return false}var b=$.tree._getSetting(d.data.treeId),a=$$(c,consts.id.CHECK,b);c.check_Focus=true;$.tree._setChkClass(b,a,c);return true},_onMouseoutCheck:function(d,c){if(c.chkDisabled===true){return false}var b=$.tree._getSetting(d.data.treeId),a=$$(c,consts.id.CHECK,b);c.check_Focus=false;$.tree._setChkClass(b,a,c);return true},_onHoverOverNode:function(d,c){var b=$.tree._getSetting(d.data.treeId),a=$.tree._getRoot(b);if(a.curHoverNode!=c){$.tree._onHoverOutNode(d)}a.curHoverNode=c;$.tree._addHoverDom(b,c)},_onHoverOutNode:function(d,c){var b=$.tree._getSetting(d.data.treeId),a=$.tree._getRoot(b);if(a.curHoverNode&&!$.tree._isSelectedNode(b,a.curHoverNode)){$.tree._removeTreeDom(b,a.curHoverNode);a.curHoverNode=null}},_onMousedownNode:function(r,h){var z,w,q=$.tree._getSetting(r.data.treeId),v=$.tree._getRoot(q),j=$.tree._getRoots();if(r.button==2||!q.editable||(!q.dragIsCopy&&!q.dragIsMove)){return true}var C=r.target,g=$.tree._getRoot(q).curSelectedList,s=[];if(!$.tree._isSelectedNode(q,h)){s=[h]}else{for(z=0,w=g.length;z<w;z++){if(g[z].editNameFlag&&$.tree._eqs(C.tagName,"input")&&C.getAttribute("treeNode"+consts.id.INPUT)!==null){return true
}s.push(g[z]);if(s[0].parentTId!==g[z].parentTId){s=[h];break}}}$.tree._editNodeBlur=true;$.tree._cancelCurEditNode(q);var F=$(q.treeObj.get(0).ownerDocument),k=$(q.treeObj.get(0).ownerDocument.body),y,m,A,B=false,D=q,f=q,a,e,t=null,d=null,p=null,b=consts.move.TYPE_INNER,x=r.clientX,u=r.clientY,n=(new Date()).getTime();if($.tree._uCanDo(q)){F.bind("mousemove",o)}function o(aE){if(v.dragFlag==0&&Math.abs(x-aE.clientX)<q.dragMinMoveSize&&Math.abs(u-aE.clientY)<q.dragMinMoveSize){return true}var az,av,W,ap,ah,ao=q.keyChildren;k.css("cursor","pointer");if(v.dragFlag==0){if($.tree._apply(q.beforeDrag,[q.treeId,s,q],true)==false){E(aE);return true}for(az=0,av=s.length;az<av;az++){if(az==0){v.dragNodeShowBefore=[]}W=s[az];if(W.isParent&&W.open){$.tree._expandCollapseNode(q,W,!W.open);v.dragNodeShowBefore[W.tId]=true}else{v.dragNodeShowBefore[W.tId]=false}}v.dragFlag=1;j.showHoverDom=false;$.tree._showIfameMask(q,true);var H=true,K=-1;if(s.length>1){var U=s[0].parentTId?s[0].getParentNode()[ao]:$.tree._getNodes(q);ah=[];for(az=0,av=U.length;az<av;az++){if(v.dragNodeShowBefore[U[az].tId]!==undefined){if(H&&K>-1&&(K+1)!==az){H=false}ah.push(U[az]);K=az}if(s.length===ah.length){s=ah;break}}}if(H){a=s[0].getPreNode();e=s[s.length-1].getNextNode()}y=$$("<ul class='treeDragUL'></ul>",q);for(az=0,av=s.length;az<av;az++){W=s[az];W.editNameFlag=false;$.tree._selectNode(q,W,az>0);$.tree._removeTreeDom(q,W);if(az>q.dragMaxShowNodeNum-1){continue}ap=$$("<li id='"+W.tId+"_tmp'></li>",q);ap.append($$(W,consts.id.A,q).clone());ap.css("padding","0");ap.children("#"+W.tId+consts.id.A).removeClass(consts.node.CURSELECTED);y.append(ap);if(az==q.dragMaxShowNodeNum-1){ap=$$("<li id='"+W.tId+"_moretmp'><a>  ...  </a></li>",q);y.append(ap)}}y.attr("id",s[0].tId+consts.id.UL+"_tmp");y.addClass(q.treeObj.attr("class"));y.appendTo(k);m=$$("<span class='tmpTreeMove_arrow'></span>",q);m.attr("id","treeMove_arrow_tmp");m.appendTo(k);q.treeObj.trigger(consts.event.DRAG,[aE,q.treeId,s])}if(v.dragFlag==1){if(A&&m.attr("id")==aE.target.id&&p&&(aE.clientX+F.scrollLeft()+2)>($("#"+p+consts.id.A,A).offset().left)){var aD=$("#"+p+consts.id.A,A);
aE.target=(aD.length>0)?aD.get(0):aE.target}else{if(A){A.removeClass(consts.node.TMPTARGET_TREE);if(p){$("#"+p+consts.id.A,A).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_final.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_final.move.TYPE_INNER)}}}A=null;p=null;B=false;D=q;var aA=$.tree._getSettings();for(var aq in aA){if(aA[aq].treeId&&aA[aq].editable&&aA[aq].treeId!=q.treeId&&(aE.target.id==aA[aq].treeId||$(aE.target).parents("#"+aA[aq].treeId).length>0)){B=true;D=aA[aq]}}var T=F.scrollTop(),aC=F.scrollLeft(),I=D.treeObj.offset(),ab=D.treeObj.get(0).scrollHeight,ar=D.treeObj.get(0).scrollWidth,aB=(aE.clientY+T-I.top),an=(D.treeObj.height()+I.top-aE.clientY-T),ai=(aE.clientX+aC-I.left),S=(D.treeObj.width()+I.left-aE.clientX-aC),V=(aB<q.dragBorderMax&&aB>q.dragBorderMin),aF=(an<q.dragBorderMax&&an>q.dragBorderMin),al=(ai<q.dragBorderMax&&ai>q.dragBorderMin),Q=(S<q.dragBorderMax&&S>q.dragBorderMin),J=aB>q.dragBorderMin&&an>q.dragBorderMin&&ai>q.dragBorderMin&&S>q.dragBorderMin,af=(V&&D.treeObj.scrollTop()<=0),ae=(aF&&(D.treeObj.scrollTop()+D.treeObj.height()+10)>=ab),M=(al&&D.treeObj.scrollLeft()<=0),Z=(Q&&(D.treeObj.scrollLeft()+D.treeObj.width()+10)>=ar);if(aE.target&&$.tree._isChildOrSelf(aE.target,D.treeId)){var R=aE.target;while(R&&R.tagName&&!$.tree._eqs(R.tagName,"li")&&R.id!=D.treeId){R=R.parentNode}var Y=true;for(az=0,av=s.length;az<av;az++){W=s[az];if(R.id===W.tId){Y=false;break}else{if($$(W,q).find("#"+R.id).length>0){Y=false;break}}}if(Y&&aE.target&&$.tree._isChildOrSelf(aE.target,R.id+consts.id.A)){A=$(R);p=R.id}}W=s[0];if(J&&$.tree._isChildOrSelf(aE.target,D.treeId)){if(!A&&(aE.target.id==D.treeId||af||ae||M||Z)&&(B||(!B&&W.parentTId))){A=D.treeObj}if(V){D.treeObj.scrollTop(D.treeObj.scrollTop()-10)}else{if(aF){D.treeObj.scrollTop(D.treeObj.scrollTop()+10)}}if(al){D.treeObj.scrollLeft(D.treeObj.scrollLeft()-10)}else{if(Q){D.treeObj.scrollLeft(D.treeObj.scrollLeft()+10)}}if(A&&A!=D.treeObj&&A.offset().left<D.treeObj.offset().left){D.treeObj.scrollLeft(D.treeObj.scrollLeft()+A.offset().left-D.treeObj.offset().left)
}}y.css({top:(aE.clientY+T+3)+"px",left:(aE.clientX+aC+3)+"px"});var ad=0;var ac=0;if(A&&A.attr("id")!=D.treeId){var am=p==null?null:$.tree._getNodeCache(D,p),ag=((aE.ctrlKey||aE.metaKey)&&q.dragIsMove&&q.dragIsCopy)||(!q.dragIsMove&&q.dragIsCopy),O=!!(a&&p===a.tId),ak=!!(e&&p===e.tId),ax=(W.parentTId&&W.parentTId==p),aj=(ag||!ak)&&$.tree._apply(D.dragPrev,[D.treeId,s,am,D],!!D.dragPrev),N=(ag||!O)&&$.tree._apply(D.dragNext,[D.treeId,s,am,D],!!D.dragNext),G=(ag||!ax)&&!(D.keepLeaf&&!am.isParent)&&$.tree._apply(D.dragInner,[D.treeId,s,am,D],!!D.dragInner);if(!aj&&!N&&!G){A=null;p="";b=consts.move.TYPE_INNER;m.css({display:"none"});if(window.TreeMoveTimer){clearTimeout(window.TreeMoveTimer);window.TreeMoveTargetNodeTId=null}}else{var aa=$("#"+p+consts.id.A,A),au=am.isLastNode?null:$("#"+am.getNextNode().tId+consts.id.A,A.next()),aw=aa.offset().top,ay=aa.offset().left,at=aj?(G?0.25:(N?0.5:1)):-1,P=N?(G?0.75:(aj?0.5:0)):-1,L=(aE.clientY+T-aw)/aa.height();if((at==1||L<=at&&L>=-0.2)&&aj){ad=1-m.width();ac=aw-m.height()/2;b=consts.move.TYPE_PREV}else{if((P==0||L>=P&&L<=1.2)&&N){ad=1-m.width();ac=(au==null||(am.isParent&&am.open))?(aw+aa.height()-m.height()/2):(au.offset().top-m.height()/2);b=consts.move.TYPE_NEXT}else{ad=5-m.width();ac=aw;b=consts.move.TYPE_INNER}}m.css({display:"block",top:ac+"px",left:(ay+ad)+"px"});if(q.dragStyle=="line"){if(consts.move.TYPE_INNER==b){m.removeClass("preNext_line").addClass("inner_line")}else{m.removeClass("inner_line").addClass("preNext_line")}}aa.addClass(consts.node.TMPTARGET_NODE+"_"+b);if(t!=p||d!=b){n=(new Date()).getTime()}if(am&&am.isParent&&b==consts.move.TYPE_INNER){var X=true;if(window.TreeMoveTimer&&window.TreeMoveTargetNodeTId!==am.tId){clearTimeout(window.TreeMoveTimer);window.TreeMoveTargetNodeTId=null}else{if(window.TreeMoveTimer&&window.TreeMoveTargetNodeTId===am.tId){X=false}}if(X){window.TreeMoveTimer=setTimeout(function(){if(b!=consts.move.TYPE_INNER){return}if(am&&am.isParent&&!am.open&&(new Date()).getTime()-n>D.dragAutoOpenTime&&$.tree._apply(D.beforeDragOpen,[D.treeId,am,D],true)){$.tree._switchNode(D,am);
if(D.dragAutoExpandTrigger){D.treeObj.trigger(consts.event.EXPAND,[D.treeId,am])}}},D.dragAutoOpenTime+50);window.TreeMoveTargetNodeTId=am.tId}}}}else{b=consts.move.TYPE_INNER;if(A&&$.tree._apply(D.dragInner,[D.treeId,s,null,D],!!D.dragInner)){A.addClass(consts.node.TMPTARGET_TREE)}else{A=null}m.css({display:"none"});if(window.TreeMoveTimer){clearTimeout(window.TreeMoveTimer);window.TreeMoveTargetNodeTId=null}}t=p;d=b;q.treeObj.trigger(consts.event.DRAGMOVE,[aE,q.treeId,s])}return false}F.bind("mouseup",E);function E(N){if(window.TreeMoveTimer){clearTimeout(window.TreeMoveTimer);window.TreeMoveTargetNodeTId=null}t=null;d=null;F.unbind("mousemove",o);F.unbind("mouseup",E);F.unbind("selectstart",c);k.css("cursor","auto");if(A){A.removeClass(consts.node.TMPTARGET_TREE);if(p){$("#"+p+consts.id.A,A).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_final.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_final.move.TYPE_INNER)}}$.tree._showIfameMask(q,false);j.showHoverDom=true;if(v.dragFlag==0){return}v.dragFlag=0;var L,H,M;for(L=0,H=s.length;L<H;L++){M=s[L];if(M.isParent&&v.dragNodeShowBefore[M.tId]&&!M.open){$.tree._expandCollapseNode(q,M,!M.open);delete v.dragNodeShowBefore[M.tId]}}if(y){y.remove()}if(m){m.remove()}var G=((N.ctrlKey||N.metaKey)&&q.dragIsMove&&q.dragIsCopy)||(!q.dragIsMove&&q.dragIsCopy);if(!G&&A&&p&&s[0].parentTId&&p==s[0].parentTId&&b==consts.move.TYPE_INNER){A=null}if(A){var I=p==null?null:$.tree._getNodeCache(D,p);if($.tree._apply(q.beforeDrop,[D.treeId,s,I,b,G,q],true)==false){$.tree._selectNodes(f,s);return}var J=G?$.tree._clone(s):s;function K(){if(B){if(!G){for(var P=0,O=s.length;P<O;P++){$.tree._removeNode(q,s[P])}}if(b==consts.move.TYPE_INNER){$.tree._addNodes(D,I,J)}else{$.tree._addNodes(D,I.getParentNode(),J);if(b==consts.move.TYPE_PREV){for(P=0,O=J.length;P<O;P++){$.tree._moveNode(D,I,J[P],b,false)}}else{for(P=-1,O=J.length-1;P<O;O--){$.tree._moveNode(D,I,J[O],b,false)}}}}else{if(G&&b==consts.move.TYPE_INNER){$.tree._addNodes(D,I,J)
}else{if(G){$.tree._addNodes(D,I.getParentNode(),J)}if(b!=consts.move.TYPE_NEXT){for(P=0,O=J.length;P<O;P++){$.tree._moveNode(D,I,J[P],b,false)}}else{for(P=-1,O=J.length-1;P<O;O--){$.tree._moveNode(D,I,J[O],b,false)}}}}$.tree._selectNodes(D,J);$$(J[0],q).focus().blur();q.treeObj.trigger(consts.event.DROP,[N,D.treeId,J,I,b,G])}if(b==consts.move.TYPE_INNER&&$.tree._canAsync(D,I)){$.tree._asyncNode(D,I,false,K)}else{K()}}else{$.tree._selectNodes(f,s);q.treeObj.trigger(consts.event.DROP,[N,q.treeId,s,null,null,null])}}F.bind("selectstart",c);function c(){return false}if(r.preventDefault){r.preventDefault()}return true},_apply:function(b,e,a){if(b==a&&!$.isFunction(b)){return a}if(typeof(b)=="undefined"||b==null){return a}var f,c,d;f=$.coral.toFunction(b);if(!$.isFunction(f)){return a}c=f.apply(d||coralTree,e?e:[]);return typeof(c)=="undefined"?a:c},_canAsync:function(a,c){var b=a.keyChildren;return(a.asyncEnable&&c&&c.isParent&&!(c.zAsync||(c[b]&&c[b].length>0)))},_clone:function(b){if(b===null){return null}var c=$.tree._isArray(b)?[]:{};for(var a in b){c[a]=(b[a] instanceof Date)?new Date(b[a].getTime()):(typeof b[a]==="object"?arguments.callee(b[a]):b[a])}return c},_eqs:function(b,a){return b.toLowerCase()===a.toLowerCase()},_isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},_$:function(b,c,a){if(!!c&&typeof c!="string"){a=c;c=""}if(typeof b=="string"){return $(b,a?a.treeObj.get(0).ownerDocument:null)}else{return $("#"+b.tId+c,a?a.treeObj:null)}},_getMDom:function(d,c,e){if(!c){return null}while(c&&c.id!==d.treeId){for(var b=0,a=e.length;c.tagName&&b<a;b++){if($.tree._eqs(c.tagName,e[b].tagName)&&c.getAttribute(e[b].attrName)!==null){return c}}c=c.parentNode}return null},_getNodeMainDom:function(a){return($(a).parent("li").get(0)||$(a).parentsUntil("li").parent().get(0))},_isChildOrSelf:function(a,b){return($(a).closest("#"+b).length>0)},_uCanDo:function(a,b){return true},_getAbs:function(b){var d=b.getBoundingClientRect(),a=document.body.scrollTop+document.documentElement.scrollTop,c=document.body.scrollLeft+document.documentElement.scrollLeft;
return[d.left+c,d.top+a]},_inputFocus:function(a){if(a.get(0)){a.focus();$.tree._setCursorPosition(a.get(0),a.val().length)}},_inputSelect:function(a){if(a.get(0)){a.focus();a.select()}},_setCursorPosition:function(b,c){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,c)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",c);a.moveStart("character",c);a.select()}}},_showIfameMask:function(h,f){var e=$.tree._getRoot(h);while(e.dragMaskList.length>0){e.dragMaskList[0].remove();e.dragMaskList.shift()}if(f){var j=$$("iframe",h);for(var d=0,b=j.length;d<b;d++){var c=j.get(d),a=$.tree._getAbs(c),g=$$("<div id='treeMask_"+d+"' class='treeMask' style='top:"+a[1]+"px; left:"+a[0]+"px; width:"+c.offsetWidth+"px; height:"+c.offsetHeight+"px;'></div>",h);g.appendTo($$("body",h));e.dragMaskList.push(g)}}},_addNodes:function(f,a,c,g){if(f.keepLeaf&&a&&!a.isParent){return}if(!$.tree._isArray(c)){c=[c]}if(f.simpleDataEnable){c=$.tree._transformToTreeFormat(f,c)}if(a){var b=$$(a,consts.id.SWITCH,f),e=$$(a,consts.id.ICON,f),d=$$(a,consts.id.UL,f);if(!a.open){$.tree._replaceSwitchClass(a,b,consts.arrow.RIGHT);$.tree._replaceIcoClass(a,e,consts.folder.CLOSE);a.open=false;d.css({display:"none"})}$.tree._addNodesData(f,a,c);$.tree._createNodes(f,a.level+1,c,a);if(!g){$.tree._expandCollapseParentNode(f,a,true)}}else{$.tree._addNodesData(f,$.tree._getRoot(f),c);$.tree._createNodes(f,0,c,null)}},_appendNodes:function(r,b,c,n,a,d){if(!c){return[]}var m=[],e=r.keyChildren;for(var k=0,j=c.length;k<j;k++){var h=c[k];if(a){var g=(n)?n:$.tree._getRoot(r),q=g[e],p=((q.length==c.length)&&(k==0)),o=(k==(c.length-1));$.tree._initNode(r,b,h,n,p,o,d);$.tree._addNodeCache(r,h)}var f=[];if(h[e]&&h[e].length>0){f=$.tree._appendNodes(r,b+1,h[e],h,a,d&&h.open)}if(d){$.tree._makeDOMNodeMainBefore(m,r,h);$.tree._makeDOMNodeNameBefore(m,r,h);$.tree._addDiyDom(m,r,h);$.tree._makeDOMNodeLine(m,r,h);$.tree._getBeforeA(r,h,m);$.tree._getInnerBeforeA(r,h,m);$.tree._makeDOMNodeIcon(m,r,h);
$.tree._getInnerAfterA(r,h,m);$.tree._makeDOMNodeNameAfter(m,r,h);$.tree._getAfterA(r,h,m);if(h.isParent&&h.open){$.tree._makeUlHtml(r,h,m,f.join(""))}$.tree._makeDOMNodeMainAfter(m,r,h);$.tree._addCreatedNode(r,h)}}return m},_appendParentULDom:function(d,f){var c=[],b=$$(f,d);if(!b.get(0)&&!!f.parentTId){$.tree._appendParentULDom(d,f.getParentNode());b=$$(f,d)}var g=$$(f,consts.id.UL,d);if(g.get(0)){g.remove()}var e=d.keyChildren,a=$.tree._appendNodes(d,f.level+1,f[e],f,false,true);$.tree._makeUlHtml(d,f,c,a.join(""));b.append(c.join(""))},_asyncNode:function(setting,node,isSilent,callback,opts){var opts=opts||{};var i,l;var isInit=setting.isInit;if(node&&!node.isParent){$.tree._apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if($.tree._apply(setting.beforeAsync,[setting.treeId,node,setting],true)==false){$.tree._apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={},asyncOtherParam=opts.asyncOtherParam||setting.asyncOtherParam;var autoParams=setting.asyncAutoParam.split(",");var isInit=setting.isInit;for(i=0,l=autoParams.length;node&&i<l;i++){var pKey=autoParams[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if($.tree._isArray(asyncOtherParam)){for(i=0,l=asyncOtherParam.length;i<l;i+=2){tmpParam[asyncOtherParam[i]]=asyncOtherParam[i+1]}}else{for(var p in asyncOtherParam){tmpParam[p]=asyncOtherParam[p]}}var _tmpV=$.tree._getRoot(setting)._ver,asyncUrl=$.tree._apply(setting.asyncUrl,[setting.treeId,node,setting],setting.asyncUrl);$.ajax({contentType:setting.asyncContentType,type:setting.asyncType,url:asyncUrl,data:tmpParam,dataType:setting.asyncDataType,success:function(msg){if(_tmpV!=$.tree._getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg
}}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}$.tree._setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){if(isInit){newNodes=$.tree._createRootNodes(setting,newNodes)}newNodes=$.tree._apply(setting.asyncDataFilter,[setting.treeId,node,newNodes,setting],newNodes);$.tree._addNodes(setting,node,!!newNodes?$.tree._clone(newNodes):[],!!isSilent)}else{if(isInit){newNodes=$.tree._createRootNodes(setting,newNodes)}$.tree._addNodes(setting,node,rootNodes,!!isSilent)}if(opts.onLoad){$.tree._apply(opts.onLoad,[setting.treeId,node,msg])}else{setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg])}$.tree._apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=$.tree._getRoot(setting)._ver){return}if(node){node.isAjaxing=null}$.tree._setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},_addEditBtn:function(b,c){if(c.editNameFlag||$$(c,consts.id.EDIT,b).length>0){return}if(!$.tree._apply(b.showRenameBtn,[b.treeId,c,b],b.showRenameBtn)){return}var d=$$(c,consts.id.A,b),a="<span class='"+consts.className.BUTTON+" "+consts.editIcon+" edit' id='"+c.tId+consts.id.EDIT+"' title='"+$.tree._apply(b.renameTitle,[b.treeId,c,b],b.renameTitle)+"' treeNode"+consts.id.EDIT+" style='display:none;'></span>";d.append(a);$$(c,consts.id.EDIT,b).bind("click",function(){if(!$.tree._uCanDo(b)||$.tree._apply(b.beforeEditName,[b.treeId,c,b],true)==false){return false}$.tree._editNode(b,c);return false}).show()},_addRemoveBtn:function(a,b){if(b.editNameFlag||$$(b,consts.id.REMOVE,a).length>0){return}if(!$.tree._apply(a.showRemoveBtn,[a.treeId,b,a],a.showRemoveBtn)){return}var d=$$(b,consts.id.A,a),c="<span class='"+consts.className.BUTTON+" "+consts.removeIcon+" remove' id='"+b.tId+consts.id.REMOVE+"' title='"+$.tree._apply(a.removeTitle,[a.treeId,b,a],a.removeTitle)+"' treeNode"+consts.id.REMOVE+" style='display:none;'></span>";
d.append(c);$$(b,consts.id.REMOVE,a).bind("click",function(){if(!$.tree._uCanDo(a)||$.tree._apply(a.beforeRemove,[a.treeId,b,a],true)==false){return false}$.tree._removeNode(a,b);a.treeObj.trigger(consts.event.REMOVE,[a.treeId,b]);return false}).bind("mousedown",function(e){return true}).show()},_addHoverDom:function(a,b){if($.tree._getRoots().showHoverDom){b.isHover=true;if(a.editable){$.tree._addEditBtn(a,b);$.tree._addRemoveBtn(a,b)}$$(b,consts.id.A,a).addClass(consts.node.CURHOVER);$.tree._apply(a.addHoverDom,[a.treeId,b,a])}},_cancelPreSelectedNode:function(c,d){var e=$.tree._getRoot(c).curSelectedList;for(var b=0,a=e.length-1;a>=b;a--){if(!d||d===e[a]){$$(e[a],consts.id.A,c).removeClass(consts.node.CURSELECTED);if(d){$.tree._removeSelectedNode(c,d);break}}}if(!d){$.tree._getRoot(c).curSelectedList=[]}},_createNodeCallback:function(b){if(!!b.onNodeCreated||!!b.addDiyDom){var a=$.tree._getRoot(b);while(a.createdNodes.length>0){var c=a.createdNodes.shift();$.tree._apply(b.addDiyDom,[b.treeId,c,b]);if(!!b.onNodeCreated){b.treeObj.trigger(consts.event.NODECREATED,[b.treeId,c])}}}},_createRootNodes:function(b,a){if(b.simpleDataEnable){a=$.tree._transformToTreeFormat(b,a)}if(b.showRootNode==true){if(b.rootNode&&typeof(b.rootNode)!=="boolean"){b.rootNode.children=a;a=[b.rootNode]}}else{if(typeof(b.rootNode)=="boolean"&&b.rootNode){if(a.length>=1){if(a[0].children&&a[0].children.length>0){a=a[0].children}else{a=[]}}}}return a},_createNodes:function(h,a,b,f){if(!b||b.length==0){return}var g=$.tree._getRoot(h),e=h.keyChildren,d=!f||f.open||!!$$(f[e][0],h).get(0);g.createdNodes=[];var i=$.tree._appendNodes(h,a,b,f,true,d);if(!f){h.treeObj.append(i.join(""))}else{var c=$$(f,consts.id.UL,h);if(c.get(0)){c.append(i.join(""))}}h.isInit=false;$.tree._createNodeCallback(h)},_checkNodeRelation:function(k,d){var h,f,e,c=k.keyChildren,b=k.keyChecked,a=consts.radio;if(k.chkStyle==a.STYLE){var j=$.tree._getRadioCheckedList(k);if(d[b]){if(k.radioType==a.TYPE_ALL){for(f=j.length-1;f>=0;
f--){h=j[f];if(h[b]&&h!=d){h[b]=false;j.splice(f,1);$.tree._setChkClass(k,$$(h,consts.id.CHECK,k),h);if(h.parentTId!=d.parentTId){$.tree._repairParentChkClassWithSelf(k,h)}}}j.push(d)}else{var g=(d.parentTId)?d.getParentNode():$.tree._getRoot(k);for(f=0,e=g[c].length;f<e;f++){h=g[c][f];if(h[b]&&h!=d){h[b]=false;$.tree._setChkClass(k,$$(h,consts.id.CHECK,k),h)}}}}else{if(k.radioType==a.TYPE_ALL){for(f=0,e=j.length;f<e;f++){if(d==j[f]){j.splice(f,1);break}}}}}else{if(d[b]&&(!d[c]||d[c].length==0||k.chkboxType.Y.indexOf("s")>-1)){$.tree._setSonNodeCheckBox(k,d,true)}if(!d[b]&&(!d[c]||d[c].length==0||k.chkboxType.N.indexOf("s")>-1)){$.tree._setSonNodeCheckBox(k,d,false)}if(d[b]&&k.chkboxType.Y.indexOf("p")>-1){$.tree._setParentNodeCheckBox(k,d,true)}if(!d[b]&&k.chkboxType.N.indexOf("p")>-1){$.tree._setParentNodeCheckBox(k,d,false)}}},_cancelCurEditNode:function(h,i,e){var g=$.tree._getRoot(h),d=h.keyName,b=g.curEditNode;if(b){var c=g.curEditInput,f=i?i:(e?b[d]:c.val());if($.tree._apply(h.beforeReName,[h.treeId,b,f,e,h],true)===false){return false}else{b[d]=f;h.treeObj.trigger(consts.event.RENAME,[h.treeId,b,e])}var a=$$(b,consts.id.A,h);a.removeClass(consts.node.CURSELECTED_EDIT);c.unbind();$.tree._setNodeName(h,b);b.editNameFlag=false;g.curEditNode=null;g.curEditInput=null;$.tree._selectNode(h,b,false)}g.noSelection=true;return true},_editNode:function(d,e){var a=$.tree._getRoot(d);$.tree._editNodeBlur=false;if($.tree._isSelectedNode(d,e)&&a.curEditNode==e&&e.editNameFlag){setTimeout(function(){$.tree._inputFocus(a.curEditInput)},0);return}var c=d.keyName;e.editNameFlag=true;$.tree._removeTreeDom(d,e);$.tree._cancelCurEditNode(d);$.tree._selectNode(d,e,false);$$(e,consts.id.SPAN,d).html("<input type=text class='rename' id='"+e.tId+consts.id.INPUT+"' treeNode"+consts.id.INPUT+" >");var b=$$(e,consts.id.INPUT,d);b.attr("value",e[c]);if(d.editNameSelectAll){$.tree._inputSelect(b)}else{$.tree._inputFocus(b)}b.bind("blur",function(f){if(!$.tree._editNodeBlur){$.tree._cancelCurEditNode(d)
}}).bind("keydown",function(f){if(f.keyCode=="13"){$.tree._editNodeBlur=true;$.tree._cancelCurEditNode(d)}else{if(f.keyCode=="27"){$.tree._cancelCurEditNode(d,null,true)}}}).bind("click",function(f){return false}).bind("dblclick",function(f){return false});$$(e,consts.id.A,d).addClass(consts.node.CURSELECTED_EDIT);a.curEditInput=b;a.noSelection=false;a.curEditNode=e},_destroy:function(a){if(!a){return}$.tree._initCache(a);$.tree._initRoot(a);$.tree._unbindTree(a);$.tree._unbindEvent(a);a.treeObj.empty();delete settings[a.treeId]},_expandCollapseNode:function(j,f,a,b,i){var h=$.tree._getRoot(j),e=j.keyChildren;if(!f){$.tree._apply(i,[]);return}if(h.expandTriggerFlag){var k=i;i=function(){if(k){k()}if(f.open){j.treeObj.trigger(consts.event.EXPAND,[j.treeId,f])}else{j.treeObj.trigger(consts.event.COLLAPSE,[j.treeId,f])}};h.expandTriggerFlag=false}if(!f.open&&f.isParent&&((!$$(f,consts.id.UL,j).get(0))||(f[e]&&f[e].length>0&&!$$(f[e][0],j).get(0)))){$.tree._appendParentULDom(j,f);$.tree._createNodeCallback(j)}if(f.open==a){$.tree._apply(i,[]);return}var d=$$(f,consts.id.UL,j),g=$$(f,consts.id.SWITCH,j),c=$$(f,consts.id.ICON,j);if(f.isParent){f.open=!f.open;if(f.iconOpen&&f.iconClose){c.attr("style",$.tree._makeNodeIcoStyle(j,f))}if(f.open){$.tree._replaceSwitchClass(f,g,consts.arrow.DOWN);$.tree._replaceIcoClass(f,c,consts.folder.OPEN);if(b==false||j.expandSpeed==""){d.show();$.tree._apply(i,[])}else{if(f[e]&&f[e].length>0){d.slideDown(j.expandSpeed,i)}else{d.show();$.tree._apply(i,[])}}}else{$.tree._replaceSwitchClass(f,g,consts.arrow.RIGHT);$.tree._replaceIcoClass(f,c,consts.folder.CLOSE);if(b==false||j.expandSpeed==""||!(f[e]&&f[e].length>0)){d.hide();$.tree._apply(i,[])}else{d.slideUp(j.expandSpeed,i)}}}else{$.tree._apply(i,[])}},_expandCollapseParentNode:function(a,b,d,c,e){if(!b){return}if(!b.parentTId){$.tree._expandCollapseNode(a,b,d,c,e);return}else{$.tree._expandCollapseNode(a,b,d,c)}if(b.parentTId){$.tree._expandCollapseParentNode(a,b.getParentNode(),d,c,e)}},_expandCollapseSonNode:function(n,d,a,b,k){var j=$.tree._getRoot(n),c=n.keyChildren,h=(d)?d[c]:j[c],m=(d)?false:b,f=$.tree._getRoot(n).expandTriggerFlag;
$.tree._getRoot(n).expandTriggerFlag=false;if(h){for(var g=0,e=h.length;g<e;g++){if(h[g]){$.tree._expandCollapseSonNode(n,h[g],a,m)}}}$.tree._getRoot(n).expandTriggerFlag=f;$.tree._expandCollapseNode(n,d,a,b,k)},_makeDOMNodeIcon:function(b,c,d){var e=$.tree._getNodeName(c,d),a=c.nameIsHTML?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(c.formatter){a=$.tree._apply(c.formatter,[c,d,a,c],c.formatter)}b.push("<span id='",d.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",$.tree._makeNodeIcoClass(c,d),"' style='",$.tree._makeNodeIcoStyle(c,d),"'></span><span id='",d.tId,consts.id.SPAN,"' class='coral-tree-node-name'>",a,"</span>")},_makeDOMNodeLine:function(a,b,c){a.push("<span id='",c.tId,consts.id.SWITCH,"' title='' class='",$.tree._makeNodeLineClass(b,c),"' treeNode",consts.id.SWITCH,"></span>")},_makeDOMNodeMainAfter:function(a,b,c){a.push("</li>")},_makeDOMNodeMainBefore:function(a,b,c){a.push("<li ",(c.hidden?"style='display:none;' ":""),"id='",c.tId,"' class='",consts.className.LEVEL,c.level,"' tabindex='0' hidefocus='true' treenode>")},_makeDOMNodeNameAfter:function(a,b,c){a.push("</a>")},_makeDOMNodeNameBefore:function(c,d,e){var i=$.tree._getNodeTitle(d,e),b=$.tree._makeNodeUrl(d,e),a=$.tree._makeNodeFontCss(d,e),h=[];for(var g in a){h.push(g,":",a[g],";")}c.push("<a id='",e.tId,consts.id.A,"' class='",consts.className.LEVEL,e.level,"' treeNode",consts.id.A,' onclick="',(e.click||""),'" ',((b!=null&&b.length>0)?"href='"+b+"'":"")," target='",$.tree._makeNodeTarget(e),"' style='",h.join(""),"'");if($.tree._apply(d.showTitle,[d.treeId,e,d],d.showTitle)&&i){c.push("title='",i.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}c.push(">")},_addDiyDom:function(a,b,c){if(c.level>0){a.push($.tree._getIndent(b,c))}},_getIndent:function(c,d){var e=16;if(d.getParentNode()){var b="",f,a=["cui-icon"];if(d.getParentNode().getNextNode()){if(c.showLine){a.push(consts.line.LINE)}else{a.push(consts.line.NOLINE)}b="<span class='treeLine "+a.join("-")+"' style='width:"+e+"px;'></span>"
}else{b="<span class='treeIndent' style='width:"+e+"px;'></span>"}return $.tree._getIndent(c,d.getParentNode())+b}else{return""}},_makeNodeFontCss:function(a,b){var c=$.tree._apply(a.fontCss,[a.treeId,b,a],a.fontCss);return(c&&((typeof c)!="function"))?c:{}},_makeNodeIcoClass:function(d,e){var c=(e.isParent&&e.iconOpen&&e.iconClose)?(e.open?e.iconOpen:e.iconClose):e.icon,a=e.isParent?" coral-tree-icon-parent":" coral-tree-icon-leaf";if(!c){var b=["cui-icon"];if(!e.isAjaxing){b[0]=(e.iconSkin?e.iconSkin+"-":"")+b[0];if(d.showIcon){if(e.isParent){b.push(e.open?consts.folder.OPEN:consts.folder.CLOSE)}else{b.push(consts.folder.FILE)}}}return consts.className.BUTTON+a+" "+b.join("-")}else{if(d.iconUrl==true){return consts.className.BUTTON}else{return consts.className.BUTTON+" "+c}}},_makeNodeIcoStyle:function(b,c){var d=[];if(!c.isAjaxing){var a=(c.isParent&&c.iconOpen&&c.iconClose)?(c.open?c.iconOpen:c.iconClose):c.icon;if(a){if(b.iconUrl==true){d.push("background:url(",a,") 0 0 no-repeat;")}else{$.tree._makeNodeIcoClass(b,c)}}if(b.showIcon==false||!$.tree._apply(b.showIcon,[b.treeId,c,b],true)){d.push("width:0px;height:0px;display:none")}}return d.join("")},_makeNodeLineClass:function(c,d){var b=[],a="cui-icon-";if(c.showLine==true){if(d.isParent){b.push(d.open?consts.arrow.DOWN:consts.arrow.RIGHT)}else{if(d.isLastNode){b.push(consts.line.BOTTOM);a="cui-icon-"}else{b.push(consts.line.CENTER);a="cui-icon-"}}}else{if(d.isParent){b.push(d.open?consts.arrow.DOWN:consts.arrow.RIGHT)}else{b.push(consts.folder.DOCU)}}return $.tree._makeNodeLineClassEx(d)+a+b.join("-")},_makeNodeLineClassEx:function(a){return consts.className.BUTTON+" "+consts.className.LEVEL+a.level+" "+consts.className.SWITCH+" "},_makeNodeTarget:function(a){return(a.target||"_blank")},_makeNodeUrl:function(b,c){var a=b.keyUrl;return c[a]?c[a]:null},_makeUlHtml:function(b,d,a,c){a.push("<ul id='",d.tId,consts.id.UL,"' class='",consts.className.LEVEL,d.level," ",$.tree._makeUlLineClass(b,d),"' style='display:",(d.open?"block":"none"),"'>");
a.push(c);a.push("</ul>")},_makeUlLineClass:function(a,b){return((a.showLine&&!b.isLastNode)?consts.line.LINE:"")},_makeChkClass:function(b,f){var a=b.keyChecked,e,i=consts.checkbox,d=consts.radio,h="",g="";if(b.chkStyle==d.STYLE){h=(f.check_Child_State<1)?i.CHECKED:i.PARTIAL;e="cui-icon-"+b.chkStyle+"-"+(f[a]?i.CHECKED:i.UNCHECKED);e+=h==i.PARTIAL?i.PARTIAL:""}else{if(f.halfCheck){h=i.PARTIAL}else{h=f[a]?((f.check_Child_State===2||f.check_Child_State===-1)?i.CHECKED:i.PARTIAL):((f.check_Child_State<1)?i.UNCHECKED:i.PARTIAL)}e="cui-icon-"+b.chkStyle+"-"+(h==i.PARTIAL?((f[a]?i.CHECKED:i.UNCHECKED)+i.PARTIAL):h)}g=(f.check_Focus&&f.chkDisabled!==true)?i.FOCUS:(f.chkDisabled==true?i.DISABLED:i.DEFAULT);return consts.className.BUTTON+" "+g+" "+e},_addLine:function(c,e,d){var b=typeof(d)=="undefined"?1:0;var f="";var a=$.tree._transformToArrayFormat(c,e);if(d!=null&&e.level!=null){f=(typeof(d)=="undefined"?0:d)-(typeof(e.level)=="undefined"?0:e.level)}for(b;b<a.length;b++){$$(a[b],consts.id.A,c).find("span:lt("+(a[b].level+f)+")").remove();$$(a[b],consts.id.A,c).prepend($.tree._getIndent(c,a[b]))}},_lineClass:function(c,b){var a=[];if(c.isParent){a=c.open?consts.arrow.DOWN:consts.arrow.RIGHT}else{if(b){if(c.level==0&&c.isLastNode&&c.isFirstNode){a=consts.line.NOLINE}else{if(c.level==0&&c.isFirstNode&&!c.isLastNode){a=consts.line.ROOTS}else{if(c.isLastNode){a=consts.line.BOTTOM}else{a=consts.line.CENTER}}}}}return a},_moveNode:function(q,d,s,c,F,e){var v=$.tree._getRoot(q),n=[],k=q.keyChildren;if(d==s){return}if(q.keepLeaf&&d&&!d.isParent&&c==consts.move.TYPE_INNER){return}var x=(s.parentTId?s.getParentNode():v),A=x.level;targetNodeIsRoot=(d===null||d==v);if(targetNodeIsRoot&&d===null){d=v}if(targetNodeIsRoot){c=consts.move.TYPE_INNER}var a=(d.parentTId?d.getParentNode():v);if(c!=consts.move.TYPE_PREV&&c!=consts.move.TYPE_NEXT){c=consts.move.TYPE_INNER}if(c==consts.move.TYPE_INNER){if(targetNodeIsRoot){s.parentTId=null}else{if(!d.isParent){d.isParent=true;d.open=!!d.open;$.tree._setNodeLineIcos(q,d)
}s.parentTId=d.tId}}var f,j;if(targetNodeIsRoot){f=q.treeObj;j=f}else{if(!e&&c==consts.move.TYPE_INNER){$.tree._expandCollapseNode(q,d,true,false)}else{if(!e){$.tree._expandCollapseNode(q,d.getParentNode(),true,false)}}f=$$(d,q);j=$$(d,consts.id.UL,q);if(!!f.get(0)&&!j.get(0)){var D=[];$.tree._makeUlHtml(q,d,D,"");f.append(D.join(""))}j=$$(d,consts.id.UL,q)}var z=$$(s,q);if(!z.get(0)){z=$.tree._appendNodes(q,s.level,[s],null,false,true).join("")}else{if(!f.get(0)){z.remove()}}if(j.get(0)&&c==consts.move.TYPE_INNER){j.append(z)}else{if(f.get(0)&&c==consts.move.TYPE_PREV){f.before(z)}else{if(f.get(0)&&c==consts.move.TYPE_NEXT){f.after(z)}}}var w,u,B=[],h=-1,y=0,E=null,b=null,p=null,g=null,C=s.level;if(s.isFirstNode){h=0;if(x[k].length>1){E=x[k][1];E.isFirstNode=true;p=E.level}}else{if(s.isLastNode){h=x[k].length-1;E=x[k][h-1];E.isLastNode=true;p=E.level}else{for(w=0,u=x[k].length;w<u;w++){if(x[k][w].tId==s.tId){h=w;break}}}}if(h>=0){x[k].splice(h,1)}if(c!=consts.move.TYPE_INNER){for(w=0,u=a[k].length;w<u;w++){if(a[k][w].tId==d.tId){y=w}}}if(c==consts.move.TYPE_INNER){if(!d[k]){d[k]=new Array()}if(d[k].length>0){b=d[k][d[k].length-1];b.isLastNode=false;g=b.level}d[k].splice(d[k].length,0,s);s.isLastNode=true;s.isFirstNode=(d[k].length==1)}else{if(d.isFirstNode&&c==consts.move.TYPE_PREV){a[k].splice(y,0,s);b=d;b.isFirstNode=false;g=b.level;s.parentTId=d.parentTId;s.isFirstNode=true;s.isLastNode=false}else{if(d.isLastNode&&c==consts.move.TYPE_NEXT){a[k].splice(y+1,0,s);b=d;b.isLastNode=false;g=b.level;s.parentTId=d.parentTId;s.isFirstNode=false;s.isLastNode=true}else{if(c==consts.move.TYPE_PREV){a[k].splice(y,0,s)}else{a[k].splice(y+1,0,s)}s.parentTId=d.parentTId;s.isFirstNode=false;s.isLastNode=false}}}$.tree._fixPIdKeyValue(q,s);$.tree._setSonNodeLevel(q,s.getParentNode(),s);var o=$$(s,consts.id.SWITCH,q);$.tree._setNodeLineIcos(q,s);$.tree._repairNodeLevelClass(q,s,C);$.tree._addLine(q,s,C);B=$.tree._lineClass(s,q.showLine);$.tree._replaceSwitchClass(s,o,B);if(!q.keepParent&&x[k].length<1){x.isParent=false;
x.open=false;var r=$$(x,consts.id.UL,q),t=$$(x,consts.id.SWITCH,q),m=$$(x,consts.id.ICON,q);B=$.tree._lineClass(x,q.showLine);$.tree._replaceSwitchClass(x,t,B);$.tree._replaceIcoClass(x,m,consts.folder.FILE);r.css("display","none");$.tree._addLine(q,x,A)}else{if(E){$.tree._setNodeLineIcos(q,E);$.tree._addLine(q,E,p)}}if(b){t=$$(b,consts.id.SWITCH,q);$.tree._setNodeLineIcos(q,b);$.tree._addLine(q,b,g);B=$.tree._lineClass(b,q.showLine);$.tree._replaceSwitchClass(b,t,B)}if(!!q.check&&q.checkable&&$.tree._repairChkClass){$.tree._repairChkClass(q,x);$.tree._repairParentChkClassWithSelf(q,x);if(x!=s.parent){$.tree._repairParentChkClassWithSelf(q,s)}}if(!e){$.tree._expandCollapseParentNode(q,s.getParentNode(),true,F)}},_removeChildNodes:function(f,h){if(!h){return}var g=f.keyChildren,d=h[g];if(!d){return}for(var e=0,a=d.length;e<a;e++){$.tree._removeNodeCache(f,d[e])}$.tree._removeSelectedNode(f);delete h[g];if(!f.keepParent){h.isParent=false;h.open=false;var c=$$(h,consts.id.SWITCH,f),b=$$(h,consts.id.ICON,f);$.tree._replaceSwitchClass(h,c,consts.line.CENTER);$.tree._replaceIcoClass(h,b,consts.line.CENTER);$$(h,consts.id.UL,f).remove()}else{$$(h,consts.id.UL,f).empty()}},_showNode:function(d,f,b,a){f.hidden=false;$.tree._initShowForExCheck(d,f);if(d.enableHighlight){var g=a.replace(/[\s]+/g," ").split(" "),c;if($$(f,d).find(".coral-tree-node-name").children()[0]){$$(f,d).find("> a >.coral-tree-node-name").html(f.name)}var e=$$(f,d).find("> a >.coral-tree-node-name").html();for(var h=0;h<g.length;h++){c=new RegExp(""+g[h]+"","gmi");if(g[h]!=""){e=e.replace(c,'<span class="coral-keyword-highlight">'+g[h]+"</span>")}}$$(f,d).find("> a >.coral-tree-node-name").html(e)}$$(f,d).show();if(typeof b!=="undefined"&&typeof b.showParents!=="undefined"&&b.showParents&&null!==f.getParentNode()){$.tree._showNode(d,f.getParentNode(),b,a)}},_initShowForExCheck:function(b,c){if(!c.hidden&&b.checkable){if(typeof c._nocheck!="undefined"){c.nocheck=c._nocheck;delete c._nocheck}if($.tree._setChkClass){var a=$$(c,consts.id.CHECK,b);
$.tree._setChkClass(b,a,c)}if($.tree._repairParentChkClassWithSelf){$.tree._repairParentChkClassWithSelf(b,c)}}},_showNodes:function(l,a,m,k){if(!a||a.length==0){return}var d={},g,f;for(g=0,f=a.length;g<f;g++){var c=a[g];if(!d[c.parentTId]){var e=c.getParentNode();d[c.parentTId]=(e===null)?$.tree._getRoot(l):c.getParentNode()}$.tree._showNode(l,c,m,k)}for(var h in d){var b=d[h][l.keyChildren];$.tree._setFirstNodeForShow(l,b);$.tree._setLastNodeForShow(l,b)}},_setFirstNodeForShow:function(e,b){var g,d,c,f,a;for(d=0,c=b.length;d<c;d++){g=b[d];if(!f&&!g.hidden&&g.isFirstNode){f=g;break}else{if(!f&&!g.hidden&&!g.isFirstNode){g.isFirstNode=true;f=g;$.tree._setNodeLineIcos(e,g)}else{if(f&&g.isFirstNode){g.isFirstNode=false;a=g;$.tree._setNodeLineIcos(e,g);break}else{g=null}}}}return{"new":f,old:a}},_setLastNodeForShow:function(e,b){var g,d,c,f,a;for(d=b.length-1;d>=0;d--){g=b[d];if(!f&&!g.hidden&&g.isLastNode){f=g;break}else{if(!f&&!g.hidden&&!g.isLastNode){g.isLastNode=true;f=g;$.tree._setNodeLineIcos(e,g)}else{if(f&&g.isLastNode){g.isLastNode=false;a=g;$.tree._setNodeLineIcos(e,g);break}else{g=null}}}}return{"new":f,old:a}},_hideNode:function(b,c,a){c.hidden=true;c.isFirstNode=false;c.isLastNode=false;$.tree._initHideForExCheck(b,c);$.tree._cancelPreSelectedNode(b,c);$$(c,b).hide()},_initHideForExCheck:function(a,b){if(b.hidden&&a.checkable){if(typeof b._nocheck=="undefined"){b._nocheck=!!b.nocheck;b.nocheck=true}b.check_Child_State=-1;if($.tree._repairParentChkClassWithSelf){$.tree._repairParentChkClassWithSelf(a,b)}}},_hideNodes:function(k,a,l){if(!a||a.length==0){return}var d={},g,f;for(g=0,f=a.length;g<f;g++){var c=a[g];if((c.isFirstNode||c.isLastNode)&&!d[c.parentTId]){var e=c.getParentNode();d[c.parentTId]=(e===null)?$.tree._getRoot(k):c.getParentNode()}$.tree._hideNode(k,c,l)}for(var h in d){var b=d[h][k.keyChildren];$.tree._setFirstNodeForHide(k,b);$.tree._setLastNodeForHide(k,b)}},_setFirstNodeForHide:function(d,a){var e,c,b;for(c=0,b=a.length;c<b;c++){e=a[c];if(e.isFirstNode){break
}if(!e.hidden&&!e.isFirstNode){e.isFirstNode=true;$.tree._setNodeLineIcos(d,e);break}else{e=null}}return e},_setLastNodeForHide:function(c,a){var d,b;for(b=a.length-1;b>=0;b--){d=a[b];if(d.isLastNode){break}if(!d.hidden&&!d.isLastNode){d.isLastNode=true;$.tree._setNodeLineIcos(c,d);break}else{d=null}}return d},_setFirstNode:function(b,a){var d=b.keyChildren,c=a[d].length;if(c>0){a[d][0].isFirstNode=true}},_setLastNode:function(b,a){var d=b.keyChildren,c=a[d].length;if(c>0){a[d][c-1].isLastNode=true}},_removeNode:function(f,j){var k=$.tree._getRoot(f),s=[],c=f.keyChildren,t=j.level,g=j.getPreNode(),a=j.getNextNode(),b=(j.parentTId)?j.getParentNode():k,e=b.level;j.isFirstNode=false;j.isLastNode=false;j.getPreNode=function(){return null};j.getNextNode=function(){return null};if(!$.tree._getNodeCache(f,j.tId)){return}$$(j,f).remove();$.tree._removeNodeCache(f,j);$.tree._removeSelectedNode(f,j);for(var p=0,n=b[c].length;p<n;p++){if(b[c][p].tId==j.tId){b[c].splice(p,1);break}}$.tree._setFirstNode(f,b);$.tree._setLastNode(f,b);var h,m,d,o=b[c].length;if(!f.keepParent&&o==0){b.isParent=false;b.open=false;h=$$(b,consts.id.UL,f);m=$$(b,consts.id.SWITCH,f);d=$$(b,consts.id.ICON,f);s=$.tree._lineClass(b,f.showLine);$.tree._replaceSwitchClass(b,m,s);$.tree._replaceIcoClass(b,d,consts.folder.FILE);h.css("display","none")}else{if(f.showLine&&o>0){var r=b[c][o-1];h=$$(r,consts.id.UL,f);m=$$(r,consts.id.SWITCH,f);d=$$(r,consts.id.ICON,f);if(b==k){if(b[c].length==1){$.tree._replaceSwitchClass(r,m,consts.arrow.DOWN)}else{var q=$$(b[c][0],consts.id.SWITCH,f);$.tree._replaceSwitchClass(b[c][0],q,(b[c][0].isParent?(b[c][0].open==true?consts.arrow.DOWN:consts.arrow.RIGHT):consts.line.ROOTS));if(!r.isParent){$.tree._replaceSwitchClass(r,m,consts.line.BOTTOM)}else{$.tree._replaceSwitchClass(r,m,(j.open==true?consts.arrow.DOWN:consts.arrow.RIGHT))}}}else{if(r.isParent){$.tree._replaceSwitchClass(r,m,(r.open?consts.arrow.DOWN:consts.arrow.RIGHT))}else{$.tree._replaceSwitchClass(r,m,consts.line.BOTTOM)
}}$.tree._addLine(f,b,e);h.removeClass(consts.line.LINE)}}},_replaceIcoClass:function(e,f,a){var c=(e.isParent&&e.iconOpen&&e.iconClose)?(e.open?e.iconOpen:e.iconClose):e.icon;if(!f||e.isAjaxing){return}var b=f.attr("class");if(b==undefined){return}var d=b.split("-");switch(a){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.FILE:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.LINE:if(c){f.attr("class",d)}else{d[d.length-1]=a;f.attr("class",d.join("-"))}break}},_replaceSwitchClass:function(d,e,a){if(!e){return}var b=e.attr("class");if(b==undefined){return}var c=b.split("-");switch(a){case consts.arrow.DOWN:case consts.arrow.RIGHT:case consts.line.NOLINE:c[c.length-1]=a;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.folder.DOCU:case consts.line.LINE:c[c.length-1]=a;break}e.attr("class",c.join("-"));if(a!==consts.folder.DOCU){e.removeAttr("disabled")}else{e.attr("disabled","disabled")}},_repairAllChk:function(e,h){if(e.checkable&&e.chkStyle===consts.checkbox.STYLE){var c=e.keyChecked,g=e.keyChildren,b=$.tree._getRoot(e);for(var d=0,a=b[g].length;d<a;d++){var f=b[g][d];if(f.nocheck!==true&&f.chkDisabled!==true){f[c]=h}$.tree._setSonNodeCheckBox(e,f,h)}}},_repairChkClass:function(b,c){if(!c){return}$.tree._makeChkFlag(b,c);if(c.nocheck!==true){var a=$$(c,consts.id.CHECK,b);$.tree._setChkClass(b,a,c)}},_repairParentChkClass:function(b,c){if(!c||!c.parentTId){return}var a=c.getParentNode();$.tree._repairChkClass(b,a);$.tree._repairParentChkClass(b,a)},_repairParentChkClassWithSelf:function(a,c){if(!c){return}var b=a.keyChildren;if(c[b]&&c[b].length>0){$.tree._repairParentChkClass(a,c[b][0])}else{$.tree._repairParentChkClass(a,c)}},_repairSonChkDisabled:function(f,h,e,c){if(!h){return}var g=f.keyChildren;if(h.chkDisabled!=e){h.chkDisabled=e}$.tree._repairChkClass(f,h);if(h[g]&&c){for(var d=0,b=h[g].length;d<b;d++){var a=h[g][d];$.tree._repairSonChkDisabled(f,a,e,c)
}}},_repairParentChkDisabled:function(c,d,b,a){if(!d){return}if(d.chkDisabled!=b&&a){d.chkDisabled=b}$.tree._repairChkClass(c,d);$.tree._repairParentChkDisabled(c,d.getParentNode(),b,a)},_selectNode:function(b,c,a){if(!a){$.tree._cancelPreSelectedNode(b)}$$(c,consts.id.A,b).addClass(consts.node.CURSELECTED);$.tree._addSelectedNode(b,c)},_setNodeFontCss:function(a,c){var d=$$(c,consts.id.A,a),b=$.tree._makeNodeFontCss(a,c);if(b){d.css(b)}},_setNodeLineIcos:function(c,d){if(!d){return}var b=$$(d,consts.id.SWITCH,c),f=$$(d,consts.id.UL,c),e=$$(d,consts.id.ICON,c),a=$.tree._makeUlLineClass(c,d);if(a.length==0){f.removeClass(consts.line.LINE)}else{f.addClass(a)}b.attr("class",$.tree._makeNodeLineClass(c,d));if(d.isParent){b.removeAttr("disabled")}else{b.attr("disabled","disabled")}e.removeAttr("style");e.attr("style",$.tree._makeNodeIcoStyle(c,d));e.attr("class",$.tree._makeNodeIcoClass(c,d))},_setNodeName:function(b,c){var e=$.tree._getNodeTitle(b,c),a=$$(c,consts.id.SPAN,b);a.empty();var d="";if(b.formatter){d=$.tree._apply(b.formatter,[b,c,b],b.formatter)}else{d=$.tree._getNodeName(b,c)}if(b.nameIsHTML){a.html(d)}else{a.text(d)}if($.tree._apply(b.showTitle,[b.treeId,c,b],b.showTitle)){var f=$$(c,consts.id.A,b);f.attr("title",!e?"":e)}},_setNodeTarget:function(a,b){var c=$$(b,consts.id.A,a);c.attr("target",$.tree._makeNodeTarget(b))},_setNodeUrl:function(b,c){var d=$$(c,consts.id.A,b),a=$.tree._makeNodeUrl(b,c);if(a==null||a.length==0){d.removeAttr("href")}else{d.attr("href",a)}},_switchNode:function(a,b){if(b.open||!$.tree._canAsync(a,b)){$.tree._expandCollapseNode(a,b,!b.open)}else{if(a.asyncEnable){if(!$.tree._asyncNode(a,b)){$.tree._expandCollapseNode(a,b,!b.open);return}}else{if(b){$.tree._expandCollapseNode(a,b,!b.open)}}}},_setChkClass:function(a,c,b){if(!c){return}if(b.nocheck===true){c.hide()}else{c.show()}c.attr("class",$.tree._makeChkClass(a,b))},_setParentNodeCheckBox:function(m,d,k,g){var c=m.keyChildren,a=m.keyChecked,h=$$(d,consts.id.CHECK,m);if(!g){g=d}$.tree._makeChkFlag(m,d);
if(d.nocheck!==true&&d.chkDisabled!==true){d[a]=k;$.tree._setChkClass(m,h,d);if(m.autoCheckTrigger&&d!=g){m.treeObj.trigger(consts.event.CHECK,[null,m.treeId,d])}}if(d.parentTId){var j=true;if(!k){var b=d.getParentNode()[c];for(var f=0,e=b.length;f<e;f++){if((b[f].nocheck!==true&&b[f].chkDisabled!==true&&b[f][a])||((b[f].nocheck===true||b[f].chkDisabled===true)&&b[f].check_Child_State>0)){j=false;break}}}if(j){$.tree._setParentNodeCheckBox(m,d.getParentNode(),k,g)}}},_setSonNodeCheckBox:function(m,d,k,g){if(!d){return}var c=m.keyChildren,a=m.keyChecked,h=$$(d,consts.id.CHECK,m);if(!g){g=d}var b=false;if(d[c]){for(var f=0,e=d[c].length;f<e&&d.chkDisabled!==true;f++){var j=d[c][f];$.tree._setSonNodeCheckBox(m,j,k,g);if(j.chkDisabled===true){b=true}}}if(d!=$.tree._getRoot(m)&&d.chkDisabled!==true){if(b&&d.nocheck!==true){$.tree._makeChkFlag(m,d)}if(d.nocheck!==true&&d.chkDisabled!==true){d[a]=k;if(!b){d.check_Child_State=(d[c]&&d[c].length>0)?(k?2:0):-1}}else{d.check_Child_State=-1}$.tree._setChkClass(m,h,d);if(m.autoCheckTrigger&&d!=g&&d.nocheck!==true&&d.chkDisabled!==true){m.treeObj.trigger(consts.event.CHECK,[null,m.treeId,d])}}},_removeEditBtn:function(a,b){$$(b,consts.id.EDIT,a).unbind().remove()},_removeRemoveBtn:function(a,b){$$(b,consts.id.REMOVE,a).unbind().remove()},_removeTreeDom:function(a,b){b.isHover=false;$.tree._removeEditBtn(a,b);$.tree._removeRemoveBtn(a,b);$$(b,consts.id.A,a).removeClass(consts.node.CURHOVER);$.tree._apply(a.removeHoverDom,[a.treeId,b,a])},_repairNodeLevelClass:function(b,d,c){if(c===d.level){return}var e=$$(d,b),h=$$(d,consts.id.A,b),g=$$(d,consts.id.UL,b),a=consts.className.LEVEL+c,f=consts.className.LEVEL+d.level;e.removeClass(a);e.addClass(f);h.removeClass(a);h.addClass(f);g.removeClass(a);g.addClass(f)},_selectNodes:function(d,b){for(var c=0,a=b.length;c<a;c++){$.tree._selectNode(d,b[c],c>0)}}};var settings={},roots={},caches={},_init={bind:[$.tree._coreBindEvent,$.tree._checkBindEvent,$.tree._editBindEvent],unbind:[$.tree._coreUnbindEvent,$.tree._checkUnbindEvent,$.tree._editUnbindEvent],caches:[$.tree._coreInitCache,$.tree._checkInitCache,$.tree._editInitCache],nodes:[$.tree._coreInitNode,$.tree._checkInitNode,$.tree._editInitNode],proxys:[$.tree._checkEventProxy,$.tree._coreEventProxy,$.tree._editEventProxy],roots:[$.tree._coreInitRoot,$.tree._checkInitRoot,$.tree._editInitRoot],beforeA:[$.tree._beforeA],afterA:[],innerBeforeA:[],innerAfterA:[],treeTools:[$.tree._checkTreeTools,$.tree._editTreeTools]};
$.coral.tree={componentName:"tree",consts:_final,getTreeObj:function(a){var b=$.tree._getTreeTools(a);return b?b:null},destroy:function(b){if(!!b&&b.length>0){$.tree._destroy($.tree._getSetting(b))}else{for(var a in settings){$.tree._destroy(settings[a])}}},init:function(g,f,c){if(!g.hasClass("coral-tree")){g.addClass("coral-tree")}g.attr("component-role","tree");if(f.clickExpand){_option.clickExpand=true;_option.dblClickExpand=false}var d=$.tree._clone(_option);$.extend(true,d,f);d.treeId=$(g).uniqueId().attr("id");d.treeObj=g;d.treeObj.empty();settings[d.treeId]=d;if(d.cls){$(g).addClass(d.cls)}if(d.componentCls){$(g).addClass(d.componentCls)}if(typeof document.body.style.maxHeight==="undefined"){d.expandSpeed=""}$.tree._initRoot(d);var a=$.tree._getRoot(d),e=d.keyChildren;c=c?$.tree._clone($.tree._isArray(c)?c:[c]):[];c=$.tree._createRootNodes(d,c);if(d.simpleDataEnable){a[e]=$.tree._transformToTreeFormat(d,c)}else{a[e]=c}$.tree._initCache(d);$.tree._unbindTree(d);$.tree._bindTree(d);$.tree._unbindEvent(d);$.tree._bindEvent(d);var b={setting:d,option:function(l,m){var h=l,n,k,j;if(arguments.length===0){return $.extend({},b.setting)}if(typeof l==="string"){h={};n=l.split(".");l=n.shift();if(n.length){k=h[l]=$.extend({},b.setting[l]);for(j=0;j<n.length-1;j++){k[n[j]]=k[n[j]]||{};k=k[n[j]]}l=n.pop();if(arguments.length===1){return k[l]===undefined?null:k[l]}k[l]=m}else{if(arguments.length===1){return b.setting[l]===undefined?null:b.setting[l]}h[l]=m}}this._setOptions(h);return this},_setOptions:function(h){var i;for(i in h){this._setOption(i,h[i])}return this},_setOption:function(h,i){b.setting[h]=i;if(h==="disabled"){if(i){$("#"+d.treeId).prepend("<div class='coral-state-disabled tree-disabled'></div>")}else{$("#"+d.treeId+" .tree-disabled").remove()}}return this},disable:function(){return b._setOptions({disabled:true})},enable:function(){return b._setOptions({disabled:false})},addNodes:function(h,i,m){var j=h!=null?(typeof(h.level)=="undefined"?0:h.level):null;if(!i){return null
}if(!h){h=null}if(h&&!h.isParent&&d.keepLeaf){return null}var l=$.tree._clone($.tree._isArray(i)?i:[i]);function k(){$.tree._addNodes(d,h,l,(m==true))}if($.tree._canAsync(d,h)){$.tree._asyncNode(d,h,m,k)}else{k()}$.tree._addLine(d,h,j);return l},cancelSelectedNode:function(h){$.tree._cancelPreSelectedNode(d,h)},destroy:function(){$.tree._destroy(d)},expandAll:function(h){h=!!h;$.tree._expandCollapseSonNode(d,null,h,true);return h},expandNode:function(k,m,j,h,i){if(!k||!k.isParent){return null}if(m!==true&&m!==false){m=!k.open}i=!!i;if(i&&m&&($.tree._apply(d.beforeExpand,[d.treeId,k,d],true)==false)){return null}else{if(i&&!m&&($.tree._apply(d.beforeCollapse,[d.treeId,k,d],true)==false)){return null}}if(m&&k.parentTId){$.tree._expandCollapseParentNode(d,k.getParentNode(),m,false)}if(m===k.open&&!j){return null}$.tree._getRoot(d).expandTriggerFlag=i;if(!$.tree._canAsync(d,k)&&j){$.tree._expandCollapseSonNode(d,k,m,true,function(){if(h!==false){try{$$(k,d).focus().blur()}catch(n){}}})}else{k.open=!m;$.tree._switchNode(this.setting,k);if(h!==false){try{$$(k,d).focus().blur()}catch(l){}}}return m},getNodes:function(){return $.tree._getNodes(d)},getNodeByParam:function(i,j,h){if(!i){return null}return $.tree._getNodeByParam(d,h?h[d.keyChildren]:$.tree._getNodes(d),i,j)},getNodeByTId:function(h){return $.tree._getNodeCache(d,h)},getNodesByParam:function(i,j,h){if(!i){return null}return $.tree._getNodesByParam(d,h?h[d.keyChildren]:$.tree._getNodes(d),i,j)},getNodesByParamFuzzy:function(i,j,h){if(!i){return null}return $.tree._getNodesByParamFuzzy(d,h?h[d.keyChildren]:$.tree._getNodes(d),i,j)},getNodesByFilter:function(i,k,h,j){k=!!k;if(!i||(typeof i!="function")){return(k?null:[])}return $.tree._getNodesByFilter(d,h?h[d.keyChildren]:$.tree._getNodes(d),i,k,j)},getNodeIndex:function(n){if(!n){return null}var m=d.keyChildren,h=(n.parentTId)?n.getParentNode():$.tree._getRoot(d);for(var k=0,j=h[m].length;k<j;k++){if(h[m][k]==n){return k}}return -1},getSelectedNodes:function(){var k=[],m=$.tree._getRoot(d).curSelectedList;
for(var j=0,h=m.length;j<h;j++){k.push(m[j])}return k},isSelectedNode:function(h){return $.tree._isSelectedNode(d,h)},reAsyncChildNodes:function(r,q,k,h){if(!this.setting.asyncEnable){return}var n=!r;if(n){r=$.tree._getRoot(d)}if(q=="refresh"){var m=this.setting.keyChildren;for(var p=0,o=r[m]?r[m].length:0;p<o;p++){$.tree._removeNodeCache(d,r[m][p])}$.tree._removeSelectedNode(d);r[m]=[];if(n){this.setting.treeObj.empty()}else{var j=$$(r,consts.id.UL,d);j.empty()}}$.tree._asyncNode(this.setting,n?null:r,!!k,null,h)},reLoadChildNodes:function(r,q,j,o){var m=!r;if(m){r=$.tree._getRoot(d)}if(q=="refresh"){var k=this.setting.keyChildren;for(var p=0,n=r[k]?r[k].length:0;p<n;p++){$.tree._removeNodeCache(d,r[k][p])}$.tree._removeSelectedNode(d);r[k]=[];if(m){this.setting.treeObj.empty()}else{var h=$$(r,consts.id.UL,d);h.empty()}}if(this.setting.isInit){o=$.tree._createRootNodes(this.setting,o)}b.addNodes(m?null:r,o,!!j)},refresh:function(){this.setting.treeObj.empty();var h=$.tree._getRoot(d),i=h[d.keyChildren];$.tree._initRoot(d);h[d.keyChildren]=i;$.tree._initCache(d);$.tree._createNodes(d,0,h[d.keyChildren])},reload:function(j){this.setting.isInit=true;if(j){j=j||{};var i=this,h=[],k=false;if(typeof(j)!=="string"){if(j.data){h=j.data}else{if(j instanceof Array){h=j}else{if(j.asyncUrl){this.setting.asyncUrl=j.asyncUrl}k=true}}}else{k=true;this.setting.asyncUrl=j}if(k&&this.setting.asyncEnable){b.reAsyncChildNodes(null,"refresh",null,j)}else{b.reLoadChildNodes(null,"refresh",null,h);$.tree._apply(j.onLoad,[null,this.setting.treeId]);if(j.onLoad){$.tree._apply(j.onLoad,[d.treeId,null,h])}else{d.treeObj.trigger(consts.event.ASYNC_SUCCESS,[d.treeId,null,h])}}}else{if(this.setting.asyncEnable){j=j||{};b.reAsyncChildNodes(null,"refresh",null,j)}}},removeChildNodes:function(j){if(!j){return null}var i=d.keyChildren,h=j[i];$.tree._removeChildNodes(d,j);return h?h:null},_pinyinEngine:function(){return new pinyinEngine()},_pinyinSetCache:function(l,j,k){for(var h in k){l.setCache([k[h][j]],k[h])
}return l},_pinyinSearch:function(j,i,k){var h=[];j.search(i,function(l){h.push(l)});k(h)},filterNodesByParam:function(k){var l=this,i=l.getNodes(),h=[],m=[];l.expandAll(true);h=l.transformToArray(i);var j=l._pinyinEngine();j=l._pinyinSetCache(j,"name",h);l.hideNodes(h);if(typeof k==="object"){$.each(k,function(o,n){if(o=="name"){l._pinyinSearch(j,n,function(p){l.showNodes(p,{showParents:true},n)})}})}},showNodes:function(i,j,h){$.tree._showNodes(d,i,j,h)},showNode:function(i,h){if(!i){return}$.tree._showNodes(d,[i],h)},hideNodes:function(h,i){$.tree._hideNodes(d,h,i)},hideNode:function(i,h){if(!i){return}$.tree._hideNodes(d,[i],h)},removeNode:function(i,h){if(!i){return}h=!!h;if(h&&$.tree._apply(d.beforeRemove,[d.treeId,i,d],true)==false){return}$.tree._removeNode(d,i);if(h){this.setting.treeObj.trigger(consts.event.REMOVE,[d.treeId,i])}},selectNode:function(i,h){if(!i){return}if($.tree._uCanDo(d)){h=d.selectedMulti&&h;if(i.parentTId){$.tree._expandCollapseParentNode(d,i.getParentNode(),true,false,function(){})}else{}$.tree._selectNode(d,i,h)}},transformToTreeNodes:function(h){return $.tree._transformToTreeFormat(d,h)},transformToArray:function(h){return $.tree._transformToArrayFormat(d,h)},updateNode:function(i,j){if(!i){return}var h=$$(i,d);if(h.get(0)&&$.tree._uCanDo(d)){$.tree._setNodeName(d,i);$.tree._setNodeTarget(d,i);$.tree._setNodeUrl(d,i);$.tree._setNodeLineIcos(d,i);$.tree._setNodeFontCss(d,i)}}};a.treeTools=b;$.tree._setTreeTools(d,b);if(d.disabled){b.disable()}else{b.enable()}d.isInit=true;d.dataLoaded=false;d.rootReload=true;if(a[e]&&a[e].length>0){$.tree._createNodes(d,0,a[e]);d.treeObj.trigger(consts.event.ASYNC_SUCCESS,[d.treeId,null,a[e]])}else{if(d.asyncEnable&&d.asyncUrl&&d.asyncUrl!==""){$.tree._asyncNode(d)}}return b}};var coralTree=$.coral.tree,$$=$.tree._$,consts=coralTree.consts;var _createNodes=$.tree._createNodes;$.tree._createNodes=function(c,d,b,a){if(_createNodes){_createNodes.apply($.tree,arguments)}if(!b){return}if($.tree._repairParentChkClassWithSelf){$.tree._repairParentChkClassWithSelf(c,a)
}};var _removeNode=$.tree._removeNode;$.tree._removeNode=function(b,c){var a=c.getParentNode();if(_removeNode){_removeNode.apply($.tree,arguments)}if(!c||!a){return}$.tree._repairChkClass(b,a);$.tree._repairParentChkClass(b,a)};var _appendNodes=$.tree._appendNodes;$.tree._appendNodes=function(e,g,b,a,d,f){var c="";if(_appendNodes){c=_appendNodes.apply($.tree,arguments)}if(a){$.tree._makeChkFlag(e,a)}return c};var _cancelPreSelectedNode=$.tree._cancelPreSelectedNode;$.tree._cancelPreSelectedNode=function(c,d){var e=$.tree._getRoot(c).curSelectedList;for(var b=0,a=e.length;b<a;b++){if(!d||d===e[b]){$.tree._removeTreeDom(c,e[b]);if(d){break}}}if(_cancelPreSelectedNode){_cancelPreSelectedNode.apply($.tree,arguments)}};var _makeNodeUrl=$.tree._makeNodeUrl;$.tree._makeNodeUrl=function(a,b){return a.editable?null:(_makeNodeUrl.apply($.tree,arguments))};var _removeNode1=$.tree._removeNode;$.tree._removeNode=function(b,c){var a=$.tree._getRoot(b);if(a.curEditNode===c){a.curEditNode=null}if(_removeNode1){_removeNode1.apply($.tree,arguments)}};var _selectNode=$.tree._selectNode;$.tree._selectNode=function(c,d,b){var a=$.tree._getRoot(c);if($.tree._isSelectedNode(c,d)&&a.curEditNode==d&&d.editNameFlag){return false}if(_selectNode){_selectNode.apply($.tree,arguments)}$.tree._addHoverDom(c,d);return true};var _uCanDo=$.tree._uCanDo;$.tree._uCanDo=function(b,c){var a=$.tree._getRoot(b);if(c&&($.tree._eqs(c.type,"mouseover")||$.tree._eqs(c.type,"mouseout")||$.tree._eqs(c.type,"mousedown")||$.tree._eqs(c.type,"mouseup"))){return true}if(a.curEditNode){$.tree._editNodeBlur=false;a.curEditInput.focus()}return(!a.curEditNode)&&(_uCanDo?_uCanDo.apply($.tree,arguments):true)};function coraltree(a,b){return b.tree(a)}$.fn.tree=function(c){var d=this;if(!this.length){return this}var a=Array.prototype.slice.call(arguments,1);var b=Array.prototype.slice.call(arguments,0);this.each(function(){var e=typeof c==="string";c=c||{};var g,f=$.parser.parseOptions(this,[],["data","fontCss","onRightClick","rootNode","chkboxType","formatter","showIcon"]);
_options=$.extend({},$.fn.tree.defaults||{},f);if(e){var i=$.coral.tree.getTreeObj($(this).attr("id"));g=i[c].apply(i,[].concat(a));if(g!==undefined){d=g}return}else{_options=$.extend({},_options,c);var h=b[1]||_options.data;$.coral.tree.init($(this),_options,h)}});return d};$.uiplugins["coralui-tree"]=coraltree;