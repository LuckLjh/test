<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css"
	href="../../libs/ztree/css/zTreeStyle.css">
<link rel="stylesheet" type="text/css"
	href="../../libs/bootstrap_3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../../css/style-common.css">
</head>
<body style="overflow: hidden; margin: 0;">

	<div class="modal dialogmodal">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" onclick="closed()">&times;</button>
					<h2 translate>任务分配</h2>
				</div>
				<div class="modal-body" id="pronotice">

					<div class="modalRadiobox">
						<form>
							<span> <label><input type="radio" checked
									name="user" id="user" value="user">用户</label>
							</span>
						</form>
					</div>

					<div class="modalLeft" id="modalLeft">
						<ul id="tree" class="ztree modalullist"></ul>
					</div>

					<div class="modalMiddle" id="modalMiddle">
						<ul id="tree2" class="ztree modalullist"></ul>
					</div>

					<div class="modalCon">
						<table>
							<tr>
								<td>
									<p>
										<span class="" id="moveCheck" onclick="moveCheck()">></span>
									</p>
									<p>
										<span class="" id="moveAll" onclick="moveAll()">>></span>
									</p>
								</td>
							</tr>
						</table>
					</div>

					<div class="modalRight" id="modalRight">
						<ul id="tree3" class="ztree modalullist"></ul>
					</div>

				</div>
				<div class="modal-footer">
					<button onclick="closed()" class="btn btn-primary">取消</button>
					<button onclick="save()" class="btn btn-primary">保存</button>
				</div>
			</div>
		</div>
	</div>

	<script src="../../libs/jquery_1.11.0/jquery.min.js"
		type="text/javascript"></script>
	<script type="text/javascript">
			//获取已经被选中的节点的名称
			var typeList = parent.document.getElementById("noticeUserId").value;
			//获取radio的类型
			var radioType = $('input:radio:checked').val();
			//获取当前的路径,并进行截取
			var url = location.href; 
       	    url = url.substring(0,url.indexOf("/widgets/"));
			//根据当前的radio类型去判断应当显示哪个树
			$.ajax({
				url:url+"/auth4/queryTreeByRadioType?radioType="+radioType,
       		 	dataType:"json",
       		 	type:"GET",
       		 	success:function(data){
       		 	var zTree;
               	var setting = {
                   view: {
                       dblClickExpand: true,
                       showLine: true,
                       selectedMulti: true
                   },
                   data: {
                       simpleData: {
                           enable:true,
                           idKey: "id",
                           pIdKey: "pId",
                           rootPId: ""
                       }
                   },
                  callback: {
                       beforeClick: function(treeId, treeNode) {
                           var zTree = $.fn.zTree.getZTreeObj("tree");
                           if (treeNode.isParent) {
                               zTree.expandNode(treeNode);
                               return false;
                           } else {
                               return true;
                           }
                       },
                       beforeClick: zTreeOnClick
                   }
              	};
               	$(function(){
               	 var t = $("#tree");
               	 t = $.fn.zTree.init(t, setting, data);
                });
               	
               	//定义当前的tree树的单击事件，然后根据返回值去刷新tree1的值
               	function zTreeOnClick(treeId, treeNode) {
            	 var treeNodeId = treeNode.id;
            	   $.ajax({
            		 url:url+"/auth4/getTreeByUser",
            		 data:{"treeNodeId":treeNodeId,"typeList":typeList},
            		 dataType:"json",
            		 type:"GET",
            		 success:function(data){
            			  var t2_setting = {
            					  check: {
            							enable: true,
            							chkStyle: "checkbox",
            							chkboxType: { "Y": "p", "N": "s" }
            						},
            		                view: {
            		                    dblClickExpand: false,
            		                    showLine: true,
            		                    selectedMulti: true
            		                },
            		                data: {
            		                    simpleData: {
            		                        enable:true,
            		                        idKey: "id",
            		                        pIdKey: "pId",
            		                        rootPId: ""
            		                    }
            		                },
            		               callback: {
            		                    beforeClick: function(treeId, treeNode) {
            		                        var zTree = $.fn.zTree.getZTreeObj("tree");
            		                        if (treeNode.isParent) {
            		                            zTree.expandNode(treeNode);
            		                            return false;
            		                        } else {
            		                            return true;
            		                        }
            		                    },
            		                    onClick: zTreeOnClick2
            		                }
            		           	};
            		             
            	            	 var t2 = $("#tree2");
            	            	 t2 = $.fn.zTree.init(t2, t2_setting, data);
            	            	 function zTreeOnClick2(event, treeId, treeNode){
            	            		 
            	            	 } 
            		 }
            	 });
            	};
               	
               	
               	
               	
               	
               	
               	
       		 	}
			});
				
             
             
             function closed(){
            	 var iframe = parent.document.getElementById("iframeTest");
            	 iframe.parentNode.removeChild(iframe);
             }
             
             function save(){
            	 var radioType = $('input:radio:checked').val();
            	 var nodeList = $.fn.zTree.getZTreeObj("tree3");
            	 if(nodeList==null){
            		 alert("保存的节点不能为空");
            	 }else{
            		 var nodes = $.fn.zTree.getZTreeObj("tree3").getNodes(); 
            		 var str='';
                	 for(var i=0;i<nodes.length;i++){
                		 if(i==nodes.length-1){
                			 str+=nodes[i].name;
                		 }else{
                			 str+=nodes[i].name+',';	 
                		 }
                         
                     }
						if(str){
							 parent.document.getElementById("noticeUserId").value = str;
							 
						}
                	
            	 }
            	 
            	 var iframe = parent.document.getElementById("iframeTest");
            	 iframe.parentNode.removeChild(iframe);
            	 
             }
             
             function moveCheck(){
            	 var treeObj = $.fn.zTree.getZTreeObj("tree2");
            	 var nodes = treeObj.getCheckedNodes(true);
            	 var t3_setting = {
   					  check: {
   							enable: true,
   							chkStyle: "checkbox",
   							chkboxType: { "Y": "p", "N": "s" }
   						},
   		                view: {
   		                    dblClickExpand: false,
   		                    showLine: true,
   		                    selectedMulti: true
   		                },
   		                data: {
   		                    simpleData: {
   		                        enable:true,
   		                        idKey: "id",
   		                        pIdKey: "pId",
   		                        rootPId: ""
   		                    }
   		                },
   		               callback: {
   		                    beforeClick: function(treeId, treeNode) {
   		                        var zTree = $.fn.zTree.getZTreeObj("tree3");
   		                        if (treeNode.isParent) {
   		                            zTree.expandNode(treeNode);
   		                            return false;
   		                        } else {
   		                            return true;
   		                        }
   		                    },
   		                    onClick: zTreeOnClick3
   		                }
   		           	};
   		             
   	            	 var t3 = $("#tree3");
   	            	 t3 = $.fn.zTree.init(t3, t3_setting, nodes);
   	            	 function zTreeOnClick3(event, treeId, treeNode){
   	            		 
   	            	 } 
             }
             
             function moveAll(){
             }
            	
           	/* //单选事件改变时触发事件 刷新当前页面的tree
           	$("[name=user]").change(function() { 
           		//获取radio的类型
    			var radioType = $('input:radio:checked').val();
    			//获取当前的路径
    		
    			var url = location.href; 
           	    url = url.substring(0,url.indexOf("/widgets/"));
    			//根据当前的radio类型去判断应当显示哪个树
    			$.ajax({
    				url:url+"/auth4/queryTreeByRadioType?radioType="+radioType,
           		 	dataType:"json",
           		 	type:"GET",
           		 	success:function(data){
           		 	var zTree;
                   	var setting = {
                       view: {
                           dblClickExpand: false,
                           showLine: true,
                           selectedMulti: true
                       },
                       data: {
                           simpleData: {
                               enable:true,
                               idKey: "id",
                               pIdKey: "pId",
                               rootPId: ""
                           }
                       },
                      callback: {
                           beforeClick: function(treeId, treeNode) {
                               var zTree = $.fn.zTree.getZTreeObj("tree");
                               if (treeNode.isParent) {
                                   zTree.expandNode(treeNode);
                                   return false;
                               } else {
                                   return true;
                               }
                           },
                           beforeClick: zTreeOnClick
                       }
                  	};
                   
                   	 var t = $("#tree");
                   	 t = $.fn.zTree.init(t, setting, data);
                   	 var t = $("#tree2");
                 	 t = $.fn.zTree.init(t, setting, null);
                   	 var t = $("#tree3");
                  	 t = $.fn.zTree.init(t, setting, null);
                 
                   	
                   	//定义当前的左边树的单击事件
                   	function zTreeOnClick(treeId, treeNode) {
                	 var treeNodeId = treeNode.id;
                	   $.ajax({
                		 url:url+"/auth4/getTreeByParamId",
                  		 data:{"treeNodeId":treeNodeId,"radioType":radioType,"typeList":typeList},
                		 dataType:"json",
                		 type:"GET",
                		 success:function(data){
                			  var t2_setting = {
                					  check: {
                							enable: true,
                							chkStyle: "checkbox",
                							chkboxType: { "Y": "p", "N": "s" }
                						},
                		                view: {
                		                    dblClickExpand: false,
                		                    showLine: true,
                		                    selectedMulti: true
                		                },
                		                data: {
                		                    simpleData: {
                		                        enable:true,
                		                        idKey: "id",
                		                        pIdKey: "pId",
                		                        rootPId: ""
                		                    }
                		                },
                		               callback: {
                		                    beforeClick: function(treeId, treeNode) {
                		                        var zTree = $.fn.zTree.getZTreeObj("tree");
                		                        if (treeNode.isParent) {
                		                            zTree.expandNode(treeNode);
                		                            return false;
                		                        } else {
                		                            return true;
                		                        }
                		                    },
                		                    onClick: zTreeOnClick2
                		                }
                		           	};
                		             
                	            	 var t2 = $("#tree2");
                	            	 t2 = $.fn.zTree.init(t2, t2_setting, data);
                	            	 function zTreeOnClick2(event, treeId, treeNode){
                	            		 
                	            	 } 
                		 }
                	 });
                	};
                   	
                   	
                   	
                   	
                   	
                   	
                   	
           		 	}
    			});
           		
           	});  */
             
             
</script>

	<script src="../../libs/ztree/jquery.ztree.core-3.5.js"
		type="text/javascript"></script>
	<script src="../../libs/ztree/jquery.ztree.excheck-3.5.min.js"
		type="text/javascript"></script>
</body>
</html>

