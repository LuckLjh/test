var _timer=false,_resizable=true;$(window).unbind(".coral-panel").bind("resize.coral-panel",function(){if(!_resizable){return}if(_timer!==false){clearTimeout(_timer)}_timer=setTimeout(function(){_resizable=false;$.coral.refreshAllComponent("body");_timer=false;_resizable=true},200)});$.component("coral.panel",{version:"4.0.2",options:{id:null,title:null,iconCls:null,width:"auto",height:"auto",left:null,top:null,cls:null,headerCls:null,bodyCls:null,style:{},href:null,cache:true,fit:false,border:true,doSize:true,showHeader:true,showTitle:true,content:null,collapsible:false,showNavButton:false,minimizable:false,maximizable:false,closable:false,collapsed:false,minimized:false,maximized:false,closed:false,tools:null,url:null,loadtext:"加载中，请耐心等候...",loadingMessage:"Loading...",extractor:function(c){var b=/<body[^>]*>((.|[\n\r])*)<\/body>/im;var a=b.exec(c);if(a){return a[1]}else{return c}},beforeOpen:$.noop,beforeClose:$.noop,beforeDestroy:$.noop,beforeCollapse:$.noop,beforeExpand:$.noop,onLoad:$.noop,onOpen:$.noop,onClose:$.noop,onDestroy:$.noop,onResize:$.noop,onMove:$.noop,onMaximize:$.noop,onRestore:$.noop,onMinimize:$.noop,onCollapse:$.noop,onExpand:$.noop},_create:function(){this.originalTitle=this.element.attr("title");this.element.removeAttr("title").addClass("ctrl-init ctrl-init-panel");this._createWrapper();this.isLoaded=false;this.element.appendTo(this.uiPanel);this._addHeader();this._setBorder();if(this.options.doSize==true){this.uiPanel.css("display","block");this.resizePanel()}if(this.options.closed==true||this.options.minimized==true){this.close()}else{this.open()}},_createWrapper:function(){var a=this;this.element.addClass("coral-panel-body");this.uiPanel=$('<div class="coral-panel"></div>').insertBefore(this.element)},_fit:function(a){return $.coral.panel.fit(this.uiPanel,a)},resizePanel:function(d){var c=this.options,b=this.uiPanel,e=b.children("div.coral-panel-header"),a=b.children("div.coral-panel-body");if(d){$.extend(c,{width:d.width,height:d.height,left:d.left,top:d.top})
}c.fit?$.extend(c,this._fit()):this._fit(false);b.css({left:c.left,top:c.top});if(!isNaN(c.width)){b.outerWidth(c.width)}else{b.width("auto")}e.add(a).outerWidth(b.width());if(!isNaN(c.height)){b.outerHeight(c.height);a.outerHeight(b.height()-e.outerHeight())}else{a.height("auto");b.css("height","")}this._doResize();if(this.toolbarEl){this.toolbarEl.toolbar("refresh")}this._trigger("onResize",null,{width:c.width,height:c.height})},_setBorder:function(){var c=this.options,b=this.uiPanel,d=this.header(),a=this.body();if(!$.isEmptyObject(c.style)){b.css(c.style)}if(c.border){d.removeClass("coral-panel-header-noborder");a.removeClass("coral-panel-body-noborder")}else{d.addClass("coral-panel-header-noborder");a.addClass("coral-panel-body-noborder")}d.addClass(c.headerCls);a.addClass(c.bodyCls)},_addHeader:function(){var a=this.options,b=this.uiPanel,g=this;if(a.tools&&typeof a.tools=="string"){b.find(">div.coral-panel-header>div.coral-panel-tool .coral-panel-tool-a").appendTo(a.tools)}b.children("div.coral-panel-header").remove();if(a.title&&a.showHeader){var f=$('<div class="coral-panel-header"></div>').prependTo(b);this.toolbarEl=$("<div></div>");this.toolbarEl.appendTo(f);var i=[];var k={type:"html",content:a.title},j={type:"button",icons:"cui-icon-arrow-up3 coral-panel-tool-collapse",label:"collapse",text:false,onClick:function(){if(a.collapsed===true){g.expand(true)}else{g.collapse(true)}}},h={type:"button",icons:"cui-icon-minus3 coral-panel-tool-min",label:"minimize",text:false,onClick:function(){g.minimize()}},e={type:"button",icons:"cui-icon-enlarge7 coral-panel-tool-max",label:"maximize",text:false,onClick:function(){if(a.maximized===true){g.restore()}else{g.maximize()}}},c={type:"button",icons:"cui-icon-cross2 coral-panel-tool-close",label:"close",text:false,onClick:function(){g.close()}};var d={data:i};if(a.toolbarOptions){$.each(a.toolbarOptions.data,function(l,m){if(m==="title"){a.toolbarOptions.data[l]=k}if(m==="collapse"){a.toolbarOptions.data[l]=j}if(m==="minimize"){a.toolbarOptions.data[l]=h
}if(m==="maximize"){a.toolbarOptions.data[l]=e}if(m==="close"){a.toolbarOptions.data[l]=c}});$.extend(true,d,a.toolbarOptions)}else{if(a.showTitle){i.push(k)}i.push("->");if(a.collapsible){i.push(j)}if(a.minimizable){i.push(h)}if(a.maximizable){i.push(e)}if(a.closable){i.push(c)}}this.toolbarEl.toolbar(d);b.children("div.coral-panel-body").removeClass("coral-panel-body-noheader")}else{b.children("div.coral-panel-body").addClass("coral-panel-body-noheader")}},toolbar:function(){return this.toolbarEl},_loadData:function(){var b=this.options,a=this;if(b.url){if(!a.isLoaded||!b.cache){a.isLoaded=false;a.element.html("");$(this.element).loading({position:"inside",text:this.options.loadtext});if(this.xhr){this.xhr.abort()}this.xhr=$.ajax(this._ajaxSettings());this.xhr.success(function(c){a.setContent(b.extractor.call(a.element,c));a._trigger("onLoad",null,arguments);a.isLoaded=true}).complete(function(d,c){if(d===a.xhr){a.xhr=null}})}}else{if(b.content){if(!a.isLoaded){a.setContent(b.content);a.isLoaded=true}}}},_ajaxSettings:function(){var b=this.options,a=this;return{url:b.url,cache:false,dataType:"html"}},_doResize:function(){$.coral.refreshChild(this.element)},_destroy:function(a){if(a!=true){if(this._trigger("beforeDestroy")==false){return}}if(this.originalTitle){this.element.attr("title",this.originalTitle)}this.element.removeClass("coral-panel-body").detach();this.element.insertAfter(this.component());this.component().remove();this._trigger("onDestroy")},component:function(){return this.uiPanel},panel:function(){return this.uiPanel},getOptions:function(){return this.options},header:function(){return this.uiPanel.find(">div.coral-panel-header")},body:function(){return this.uiPanel.find(">div.coral-panel-body")},setTitle:function(a){this.options.title=a;this.header().find("div.coral-panel-title").html(a)},setContent:function(a){this.element.children().remove();this.element.html(a);if($.parser){$.parser.parse(this.element)}},open:function(a){var c=this.options,b=null;if(a!=true){if(this._trigger("beforeOpen",null)===false){return
}}this.uiPanel.show();c.closed=false;c.minimized=false;b=this.uiPanel.children(".coral-panel-header").find("a.coral-panel-tool-restore");if(b.length){c.maximized=true}this._trigger("onOpen");if(c.maximized===true){c.maximized=false;this.maximize()}if(c.collapsed===true){c.collapsed=false;this.collapse()}if(!c.collapsed){this._loadData();this._doResize()}},close:function(c){var b=this.options;var a=this.uiPanel;if(c!=true){if(this._trigger("beforeClose",null)==false){return}}this._fit(false);a.hide();b.closed=true;this._trigger("onClose")},refresh:function(a){this.isLoaded=false;if(a){this.options.url=a}this._loadData()},reload:function(a){this.refresh(a)},resize:function(a){this.resizePanel(a)},move:function(a){var b=this.options;if(a){if(a.left!=null){b.left=a.left}if(a.top!=null){b.top=a.top}}this.uiPanel.css({left:b.left,top:b.top});this._trigger("onMove",null,{left:b.left,top:b.top})},maximize:function(){var a=this.options;if(a.maximized===true){return}this.uiPanel.children("div.coral-panel-header").find("a.coral-panel-tool-max").addClass("coral-panel-tool-restore").addClass("cui-icon-shrink7").removeClass("cui-icon-enlarge7");if(!this.original){this.original={width:a.width,height:a.height,left:a.left,top:a.top,fit:a.fit}}a.left=0;a.top=0;a.fit=true;this.resizePanel();a.minimized=false;a.maximized=true;this._trigger("onMaximize")},minimize:function(){this._fit(false);this.uiPanel.hide();this.options.minimized=true;this.options.maximized=false;this._trigger("onMinimize")},restore:function(){if(this.options.maximized===false){return}this.uiPanel.show();this.uiPanel.children("div.coral-panel-header").find("a.coral-panel-tool-max").removeClass("coral-panel-tool-restore").addClass("cui-icon-enlarge7").removeClass("cui-icon-shrink7");$.extend(this.options,this.original);this.resizePanel();this.options.minimized=false;this.options.maximized=false;this.original=null;this._trigger("onRestore")},collapse:function(b){var d=this.options,a=this.body(),c=this;if(d.collapsed===true){return
}a.stop(true,true);if(c._trigger("beforeCollapse")===false){return}this.header().find("a.coral-panel-tool-collapse").addClass("coral-panel-tool-expand");if(b===true){a.slideUp("normal",function(){d.collapsed=true;c._trigger("onCollapse")})}else{a.hide();d.collapsed=true;c._trigger("onCollapse")}},expand:function(b){var d=this.options,a=this.body(),c=this;if(d.collapsed===false){return}a.stop(true,true);if(c._trigger("beforeExpand")===false){return}this.header().find("a.coral-panel-tool-collapse").removeClass("coral-panel-tool-expand");if(b===true){a.slideDown("normal",function(){d.collapsed=false;c._trigger("onExpand");c._loadData();c._doResize()})}else{a.show();d.collapsed=false;c._trigger("onExpand");c._loadData();c._doResize()}}});$.coral.panel.fit=function(c,a){a=(a==undefined?true:a);var b=c.parent()[0];b=$(b);if(a){if(!b.hasClass("coral-panel-noscroll")){b.addClass("coral-panel-noscroll");if(b.attr("tagName")=="BODY"){$("html").addClass("coral-panel-fit")}}}else{if(b.hasClass("coral-panel-noscroll")){b.removeClass("coral-panel-noscroll");if(b.attr("tagName")=="BODY"){$("html").removeClass("coral-panel-fit")}}}return{width:b.width(),height:b.height()}};